window.opt||(opt={});opt.x=opt.x||{};opt.c=opt.c||{};
opt.fn={_el:0,parse:function(a){if(a=="false")return false;if(a=="true")return true;if(parseFloat(a).toString()==a)return parseFloat(a);return a},init:function(){var a=window.location.search.substr(1).split("&");if(window.localStorage)for(var c=0;c<localStorage.length;c++){var b=localStorage.key(c);if(b.indexOf("opt_")==0&&b.length)window.opt[b.substr(4)]=window.opt.fn.parse(localStorage[b])}for(b=0;b<a.length;b++){c=a[b].split("=");window.opt[c[0]]=c[1]?c[1]:true}},close:function(){if(opt.fn._el)try{opt.fn._el.parentNode.removeChild(opt.fn._el)}catch(a){}opt.fn._el=
0},show:function(){opt.fn.close();var a=opt.fn._el=document.createElement("div"),c='<div style="padding:7px;padding-bottom:100px;"><h1 onclick="opt.fn.close()">'+(opt.appName||"")+" Settings</h1>";for(var b in opt.x)c+='<input type="checkbox" name="'+b+'" id="'+b+'" '+(opt[b]?"checked":"")+' onchange="opt.fn.handleBoolean(this)"> <label for="'+b+'">'+opt.x[b]+" <i>("+b+")</i></label><br>";c+='<br><button onclick="opt.fn.close()">Exit settings</button></div>';a.innerHTML=c;a.style.position="absolute";
a.style.top=0;a.style.left=0;a.style.width="100%";a.style.backgroundColor="#fff";a.style.padding="0";a.style.zIndex=999999999999;a.onclick=function(d){d=d||window.event;(d.target||d.srcElement).tagName.toLowerCase()=="div"&&window.opt.fn.close()};document.body.appendChild(a)},handleBoolean:function(a){opt.fn.set(a.name,a.checked)},set:function(a,c){if(typeof opt.c[a]=="function")c=opt.c[a](c)||c;opt[a]=c;if(window.localStorage)localStorage["opt_"+a]=c.toString()}};opt.fn.init();
window.console||(console={log:function(){}});var screen_size=document.documentElement.clientWidth||innerWidth,small_screen=screen_size<500,loadIds={};searchLastIndex=0;current_search="";var edit_box,edit_text,search_container=document.getElementById("search_container"),wave_container=document.getElementById("wave_container");opt.appName="&mu;wave";
var mobilewebkit=navigator.userAgent.indexOf("WebKit")!=-1&&navigator.userAgent.indexOf("Mobile")!=-1,current_wave="",current_wavelet="",auto_reload=false,lasthash="chunkybacon",current_page=0,search_outdated=false,searchscroll=0,scrollto_position=-1;if(mobilewebkit)document.body.className+=" mobilewebkit";if(!window.onLine)window.onLine=function(){return true};opt.multipane===undefined&&screen_size>900&&!mobilewebkit&&opt.fn.set("multipane",true);opt.x.multipane="Enable multipane viewing experience (note, you must reload the page for changes to take effect)";
if(opt.multipane){document.getElementById("search_parent").insertBefore(document.getElementById("appheader"),document.getElementById("search_parent").firstChild);document.body.className+=" multipane";document.getElementById("header").innerHTML="&mu;wave";wave_container.innerHTML="<div style='padding:40px'>No waves loaded yet</div>";location.hash.indexOf("search:")==-1&&setTimeout(function(){autosearch("in:inbox");runQueue()},500)}opt.x.no_scrollhistory="Do not save search scroll position and restore to it";
opt.x.old_results="Old results panel style";opt.x.largeFont="Use a larger font";opt.c.largeFont=function(a){document.body.style.fontSize=a==true?"16px":"13px"};var prefetched_waves={},unread_blips={};opt.c.largeFont(opt.largeFont);opt.x.prefetch="Prefetch waves and load them, way faster and also not real time";
function addTouchScroll(){var a=arguments,c=document.createElement("link");c.href="js/lib/touchscroll.css";c.type="text/css";c.rel="stylesheet";document.body.appendChild(c);c=document.createElement("script");c.src="js/lib/touchscroll.min.js";c.onload=function(){setTimeout(function(){for(var b=0;b<a.length;b++){var d=a[b];console.log(d);if(typeof d=="string")d=document.getElementById(d);new TouchScroll(d,{elastic:true})}},100)};document.body.appendChild(c)}opt.x.touchscroll="Add the TouchScroll library to do cool scrolly things on iPad Multipane";
if(opt.touchscroll){addTouchScroll("wave_container_parent","search_parent_container");document.getElementById("wave_container_parent").style.width=innerWidth-300+"px";document.getElementById("wave_container").style.width=innerWidth-300+"px"}
function userList(a,c){var b=small_screen?2:5,d=document.createElement("span");if(a.length<=b||c){d.innerHTML=a.join(", ").replace(/antimatter15@googlewave.com/g,"<a href='http://antimatter15.com'>antimatter15</a>").replace(/@.*?(\,|$)/g,"$1");if(c){b=document.createElement("a");b.innerHTML=" (fewer)";b.href="javascript:void(0)";b.onclick=function(){d.parentNode.replaceChild(userList(a),d);return false};d.appendChild(b)}}else{d.innerHTML=a.slice(0,b).join(", ").replace(/antimatter15@googlewave.com/g,
"<a href='http://antimatter15.com'>antimatter15</a>").replace(/@.*?(\,|$)/g,"$1");var f=document.createElement("a");f.innerHTML=" ... ("+(a.length-b)+" more)";f.href="javascript:void(0)";f.onclick=function(){d.parentNode.replaceChild(userList(a,true),d);return false};d.appendChild(f)}return d}
function format_time(a){if(typeof a=="number"){var c=new Date;c.setTime(a);a=c}c=a.getHours();var b="am";if(c>12){c-=12;b="pm"}if(c==0)c=12;var d=a.getMinutes().toString();if(d.length==1)d="0"+d;return a.getMonth()+1+"/"+a.getDate()+" "+c+":"+d+b}function inline_blip_render(a){var c=document.createElement("div");c.className="thread";blip_render(a,c);return c}
function blip_render(a,c){var b=msg.data.blips[a];if(!(!b||b.dom)){var d=renderBlip(b);msg.data.blips[a].dom=d;d.className="message";var f=document.createElement("div");f.className="info";b.info=f;var e=chronological_blips[0]==a?' <span class="blipend">X</span>':" <span class='nextarr'>&rarr;</span></div>";f.innerHTML="<div style='float:right;color:#555'>"+format_time(b.lastModifiedTime).toString()+e;f.appendChild(userList(b.contributors));f.onclick=function(g){g=g||window.event;g.cancelBubble=true;
g.stopPropagation&&g.stopPropagation();(g.target||g.srcElement).tagName.toLowerCase()!="a"&&blip_next(b.blipId)};d.onclick=function(g){g=g||window.event;g.cancelBubble=true;g.stopPropagation&&g.stopPropagation();if((g.target||g.srcElement).tagName.toLowerCase()!="a"){console.log(b);f.parentNode.insertBefore(create_contextmenu(b),f.nextSibling)}};d.insertBefore(f,d.firstChild);c.appendChild(d);a==chronological_blips[scrollto_position]&&setTimeout(function(){blip_scroll(scrollto_position)},500);return d}}
function create_wave(){var a=loading("Creating wave...");setTimeout(function(){var c={};callbacks[wave.robot.createWavelet([],c)]=function(b){loading(a);setTimeout(function(){hashHandler("wave:"+b.data.waveId,true);runQueue()},100)};wave.wavelet.setTitle("New Wave",c.waveId,c.waveletId);runQueue()},500)}function diff(a,c){for(var b=a.length,d=c.length,f=-1,e=-1;f++<b&&a[f]==c[f];);for(;e++<b&&a[b-e]==c[d-e];);return[f,b-e+1,c.substring(f,d-e+1)]}
var current_blip=null,context_box,reply_box,reply_text,cancel,post;
function create_reply_box(){if(window.content_box)try{content_box.innerHTML="";content_box.parentNode.removeChild(content_box)}catch(a){}context_box=document.createElement("div");reply_box=document.createElement("div");reply_box.innerHTML="<div class='alert'><b>Write a Reply</b></div>";reply_text=document.createElement("textarea");cancel=document.createElement("button");post=document.createElement("button");cancel.innerHTML="Cancel";post.innerHTML="Post";cancel.onclick=function(){if(reply_text.value.split(" ").length<
42||confirm("Are you sure you want to cancel?")){context_box.style.display="none";current_blip=null}};post.onclick=function(){reply_text.disabled="disabled";setTimeout(function(){wave.blip.contentCreateChild(reply_text.value,current_blip.blipId,current_blip.waveId,current_blip.waveletId);loadWave(current_blip.waveId);auto_reload=true;runQueue()},100)};context_box.style.marginTop="10px";reply_box.appendChild(reply_text);reply_box.appendChild(post);reply_box.appendChild(cancel);context_box.appendChild(reply_box);
context_box.style.display="none";var c=reply_text.disabled="";if(navigator.userAgent.indexOf("Opera Mini")!=-1)c=" on Opera Mini";else if(mobilewebkit)c=navigator.userAgent.indexOf("Android")!=-1?" on Android":navigator.userAgent.indexOf("iPad")!=-1?" on iPad":navigator.userAgent.indexOf("iPod")!=-1?" on iPod":" on iPhone";reply_text.value="";if(!opt.no_sig)reply_text.value="\n\nPosted with micro-wave.appspot.com"+c;reply_text.className="reply_box";return context_box}ctx_menu=null;
function create_contextmenu(a){function c(){d.style.display="none";d.parentNode.removeChild(d)}if(!onLine())return document.createElement("div");try{ctx_menu.style.display="none";ctx_menu.parentNode.removeChild(ctx_menu)}catch(b){}var d=document.createElement("div");current_blip=a;d.style.zIndex=32;var f={Reply:function(){current_blip.dom.parentNode.insertBefore(create_reply_box(),current_blip.dom.nextSibling);context_box.className=a.childBlipIds.length>0?"thread":"";context_box.style.display="";
reply_text.focus();c()},Delete:function(){confirm("Are you sure you want to delete the blip?")&&setTimeout(function(){wave.blip["delete"](current_blip.blipId,current_blip.waveId,current_blip.waveletId);loadWave(current_blip.waveId);auto_reload=true;runQueue();c()},100);c()},Edit:function(){current_blip.dom.parentNode.insertBefore(create_edit_box(),current_blip.dom.nextSibling);try{for(var i=current_blip.annoations.length,h=0;h<i&&current_blip.annotations[h].name!="conv/title"&&0=current_blip.annotations[h].range.end;h++);
}catch(j){}edit_text.value=current_blip.content.substr(1);edit_text.focus();c()}};if(a.blipId==msg.data.waveletData.rootBlipId)f["Change Title"]=function(){var i=prompt("Enter new wavelet title",msg.data.waveletData.title);if(i){wave.wavelet.setTitle(i,a.waveId,a.waveletId);loadWave(a.waveId,a.waveletId);auto_reload=true;runQueue()}};for(var e in f){var g=document.createElement("a");g.href="javascript:void(0)";g.onclick=f[e];g.innerHTML=e;d.appendChild(g);d.appendChild(document.createTextNode(" / "))}g=
document.createElement("a");g.href="javascript:void(0);";g.style.color="red";g.innerHTML="Close";g.onclick=function(){c()};d.appendChild(g);d.className="contextmenu";return ctx_menu=d}
function create_edit_box(){edit_box=document.createElement("div");edit_box.style.marginRight="6px";edit_box.innerHTML="<div class='alert'><b>Edit Blip (Beta)</b></div>";edit_text=document.createElement("textarea");cancel_edit=document.createElement("button");submit_edit=document.createElement("button");cancel_edit.innerHTML="Cancel";submit_edit.innerHTML="Submit";cancel_edit.onclick=function(){edit_box.style.display="none";current_blip=null};submit_edit.onclick=function(){edit_text.disabled="disabled";
setTimeout(function(){try{for(var a=current_blip.annoations.length,c=0;c<a&&current_blip.annotations[c].name!="conv/title"&&0=current_blip.annotations[c].range.end;c++);}catch(b){}a=diff(current_blip.content.substr(0),"\n"+edit_text.value);console.log(a);console.log(current_blip.content,"\n"+edit_text.value);wave.blip.replace_range(a[2],0+a[0],0+a[1],current_blip.blipId,current_blip.waveId,current_blip.waveletId);loadWave(current_blip.waveId);auto_reload=true;runQueue()},100)};edit_box.style.marginTop=
"10px";edit_box.appendChild(edit_text);edit_box.appendChild(submit_edit);edit_box.appendChild(cancel_edit);edit_text.style.height=Math.max(current_blip.dom.offsetHeight,100)+"px";edit_text.className="edit_box";return edit_box}var gstates={},REMOTE_RPC_RELAY_URL="http://www.gmodules.com/gadgets/files/container/rpc_relay.html",DEFAULT_GADGET_MODE={"${playback}":"0","${edit}":"1"};function registerRpc(a,c){gadgets.rpc.register(a,function(){c(this.s,this.f,this.a)})}
function init_gadget_handler(a){if(window.gadgets)a();else{Math.random().toString(36).substr(4);var c=document.createElement("script");c.src="https://wave.google.com/gadgets/js/core:rpc?debug=1&c=1";(function(){if(window.gadgets){initGadgetSystem();a()}else setTimeout(arguments.callee,100)})();document.body.appendChild(c)}}
function extractGadgetState(a){console.log(a);var c=gstates[a].participants,b=gstates[a].state;gadgets.rpc.call(a,"wave_gadget_mode",null,DEFAULT_GADGET_MODE);gadgets.rpc.call(a,"wave_participants",null,c);gadgets.rpc.call(a,"wave_gadget_state",null,b);gadgets.rpc.call(a,"wave_private_gadget_state",null,{})}
function initGadgetSystem(){registerRpc("wave_enable",function(a,c){gadgets.rpc.setRelayUrl(c,REMOTE_RPC_RELAY_URL);extractGadgetState(c)});registerRpc("resize_iframe",function(a,c,b){document.getElementById(c).height=b[0]});gadgets.rpc.registerDefault(function(){var a=this.s,c=this.a[0],b=this.f;console.log(this);if(a=="wave_gadget_state"){console.log("updating state");for(var d in c)gstates[b].state[d]=c[d];wave.blip.update_element(gstates[b].state,gstates[b].blipId,current_wave,current_wavelet);
runQueue();gadgets.rpc.call(b,"wave_gadget_state",null,gstates[b].state)}console.log(a,c)})}function create_gadget_frame(a,c,b){var d=document.createElement("div");d.innerHTML='<iframe name="'+a+'" >';d=d.firstChild;d.id=a;d.width="320px";d.height="250px";d.frameBorder="yes";d.scrolling="no";d.marginHeight=0;d.marginWidth=0;b=b||document.body;b.appendChild(d);d.src=c;return d}
function load_native_gadget(a,c,b,d){var f="gadget_frame"+Math.random().toString(36).substr(4);console.log(c);for(var e={myId:username,authorId:c.properties.author,participants:{}},g=msg.data.waveletData.participants,i=g.length;i--;)e.participants[g[i]]={id:g[i],displayName:g[i].replace(/@.*$/,""),thumbnailUrl:"https://wave.google.com/a/google.com/static/images/unknown.jpg"};gstates[f]={state:a,participants:e,blipId:b.blipId};var h=opt.gsa?"http://anti15.chemicalservers.com/debugwave.xml":opt.gsa1?
"http://anti15.chemicalservers.com/state.xml":c.properties.url,j="http://www.gmodules.com/gadgets/ifr?container=wave&view=default&debug=0&lang=en&country=ALL&nocache=0&wave=1&mid="+encodeURIComponent(f)+"&parent="+encodeURIComponent(location.protocol+"//"+location.host+location.pathname)+"&url="+encodeURIComponent(h);init_gadget_handler(function(){create_gadget_frame(f,j,d);console.log("creating "+f+" for gadget "+h)})}function native_gadget(){}opt.x.gadgets="Enable real wave gadget support";
opt.gadgets===undefined&&screen_size>900&&opt.fn.set("gadgets",true);opt.x.render_state="If a gadget can not be internally rendered, display the gadget state";
function renderGadget(a,c){var b={},d=[];for(var f in a.properties){if(f!="url"&&f!="author")b[f]=a.properties[f];d.push(f)}var e=document.createElement("div");e.style.margin="10px";var g=a.properties.url;e.innerHTML="<b>gadget</b> "+g+" <br>";if(window.opt.gadgets){load_native_gadget(b,a,c,e);return e}if(g=="http://wave-api.appspot.com/public/gadgets/areyouin/gadget.xml"){var i={y:[],n:[],m:[]};for(f in b)/:answer$/.test(f)&&i[b[f]].push(f.substr(0,f.length-7));for(var h in i){e.innerHTML+="<br><span style='color:red;font-weight:bold'>"+
{m:"Maybe",y:"Yes",n:"No"}[h]+"</span><br> ";if(i[h].length==0)e.innerHTML+="(None) <br>";for(f=0;f<i[h].length;f++)e.innerHTML+=i[h][f].replace(/@googlewave.com/g,"")+' <span style="color: gray;font-style: italic">'+(b[i[h][f]+":status"]||"")+"</span><br>"}}else if(g=="http://plus-one.appspot.com/plus-one.xml"){i=0;for(f in b)i+=parseInt(b[f]);e.innerHTML+="<br><b>Votes:</b> "+i+"/"+d.length}else if(g=="http://www.elizabethsgadgets.appspot.com/public/gadget.xml")e.innerHTML+="<br> <b>Pluses</b> ("+
(b.pluses||0)+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Minuses</b> ("+(b.minuses||0)+")";else if(g=="http://pushyrobot.appspot.com/gadgets/github.xml")e.innerHTML+="<pre>"+JSON.stringify(JSON.parse(unescape(b.commit)),null,2)+"</pre>";else if(g=="http://everybodywave.appspot.com/gadget/image/gadget.xml")e.innerHTML+='<img src="'+b.imgUrl+'" width="'+b.imgWidth+'" height="'+b.imgHeight+'">';else if(g=="http://wavepollo.appspot.com/wavepollo/com.appspot.wavepollo.client.PolloWaveGadget.gadget.xml"){h={};for(i in b)if(i.indexOf("MVOTE_")==
0)if(f=i.match(/MVOTE_(.+)(OPT_.+)$/)){h[f[2]]||(h[f[2]]=[]);h[f[2]].push(f[1])}for(i in h){e.innerHTML+="<br><span style='color:red;font-weight:bold'>"+b[i]+"</span> ("+h[i].length+")<br> ";for(f=0;f<h[i].length;f++)e.innerHTML+=h[i][f].replace(/@googlewave.com/g,"")+", "}}else if(g=="https://statusee.appspot.com/gadget/statusee.xml")e.innerHTML+="<b>Status</b> "+({notstarted:"Not started",describing:"Describing",brainstorming:"Brainstorming",inprogress:"In Progress",inreview:"In Review",pending:"Pending",
testing:"Testing",completed:"Completed",rejected:"Rejected",canceled:"Canceled"}[b.sel]||b.sel.substr(7));else if(g=="http://wave-poll.googlecode.com/svn/trunk/src/poll.xml")for(i in b){h=JSON.parse(b[i]).participants;e.innerHTML+="<br><span style='color:red;font-weight:bold'>"+i.substr(7)+"</span> ("+h.length+")<br> ";for(f=0;f<h.length;f++)e.innerHTML+=h[f].replace(/@googlewave.com/g,"")+", "}else if(g=="https://everybodywave.appspot.com/gadget/miniroster/main.xml"){e.innerHTML+="<br><span style='color:red;font-weight:bold'>Assigned</span> ("+
d.length+")<br> ";for(i in b)e.innerHTML+=i.split("~")[3]+", "}else if(g=="http://www.nebweb.com.au/wave/likey.xml")e.innerHTML+="<br> <b>Like</b> ("+(b.likeCount||0)+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Dislike</b> ("+(b.dislikeCount||0)+")";else if(window.opt.render_state||JSON.stringify(b).length<1337){console.log("Unknown Gadget",g);a=document.createTextNode(JSON.stringify(b,null,2));b=document.createElement("div");b.appendChild(a);e.innerHTML+='<div class="monospace">'+b.innerHTML+"</div>"}return e}
function loading(a,c){var b=document.getElementById("loading"),d=typeof document.createElement("div").style.opacity!="undefined";b.style.top=scrollY+"px";if(typeof a=="number"){if(d)b.style.opacity="0";else b.style.display="none";delete loadIds[a]}else{var f=Math.random()*42;loadIds[f]=true;setTimeout(function(){b.style.top=scrollY+"px";if(loadIds[f]){if(d)b.style.opacity="1";else b.style.display="";document.getElementById("loadingtext").innerHTML="<b>Loading</b> "+a}},c?0:0);return f}}
var lastscrolled="";function blip_scroll(a){try{msg.data.blips[lastscrolled].info.className="info"}catch(c){}lastscrolled=chronological_blips[a];if(msg.data.blips[chronological_blips[a]].dom){msg.data.blips[lastscrolled].info.className="info selected";msg.data.blips[chronological_blips[a]].dom.scrollIntoView(true);return true}return false}
function blip_next(a){try{for(var c=[].indexOf?chronological_blips.indexOf(a):function(d,f,e){for(e=f.length;e--&&f[e]!=d;);return e}(a,chronological_blips);c&&blip_scroll(--c)==false;);}catch(b){}}function hide_float(){document.getElementById("floating_menu").className=""}function markWaveRead(){wave.robot.folderAction("markAsRead",current_wave,current_wavelet);hide_float();search_outdated=true;runQueue()}
function archiveWave(){wave.robot.folderAction("archive",current_wave,current_wavelet);hide_float();runQueue()}window.onresize=document.onscroll=window.onscroll=function(){if(current_page==0)searchscroll=scrollY;document.getElementById("loading").style.top=scrollY+"px";document.getElementById("floating_menu").style.top=scrollY+window.innerHeight-50+"px"};mobilewebkit&&setInterval(document.onscroll,1E3);
function toggle_float(){if(document.getElementById("floating_menu").className=="expanded")document.getElementById("floating_menu").className="";else document.getElementById("floating_menu").className="expanded"}username="wheisenberg@googlewave.com";function getUsername(){callbacks[wave.robot.fetchWave("googlewave.com!w+bWEBb5mBA","googlewave.com!conv+poop")]=function(a){username=a.error.message.match(/internalError: (.+@.+) is not a participant/)[1];return true}}opt.x.use_protocol_21="Use old 0.21 version of wave protocol";
wave={robot:{fetchWave:function(a,c){return queueOp("wave.robot.fetchWave",{waveId:a,waveletId:c})},search:function(a,c,b){return queueOp("wave.robot.search",{query:a,index:c,numResults:b})},folderAction:function(a,c,b){return queueOp("wave.robot.folderAction",{waveId:c,modifyHow:a,waveletId:b})},notifyCapabilitiesHash:function(a){var c=(opt.use_protocol_21?0.21:0.22).toString();return queueOp("wave.robot.notifyCapabilitiesHash",{protocolVersion:a||c})},createWavelet:function(a,c){var b="TBD_"+f+
"_0x"+(Math.random()*9E5).toString(16),d=username.replace(/^.+@/,""),f=d+"!conv+root";d=d+"!TBD_0x"+(Math.random()*9E5).toString(16);c||(c={});c.waveId=d;c.waveletId=f;c.rootBlipId=b;return queueOp("wave.robot.createWavelet",{waveletId:f,waveletData:{waveletId:f,waveId:d,rootBlipId:b,participants:a},waveId:d})}},wavelet:{appendBlip:function(a,c,b,d){var f="TBD_"+username.replace(/^.+@/,"")+"!conv+root_0x"+(Math.random()*9E5).toString(16);return queueOp("wave.wavelet.appendBlip",{waveletId:d,waveId:b,
blipId:f,blipData:{waveletId:d,blipId:f,waveId:b,content:a,parentBlipId:c},parentBlipId:c})},modifyParticipantRole:function(a,c,b,d){return queueOp("wave.wavelet.modifyParticipantRole",{waveletId:d,waveId:b,participantId:a,participantRole:c})},removeTag:function(a,c,b){return queueOp("wave.wavelet.modifyTag",{waveletId:b,waveId:c,name:a,modifyHow:"remove"})},addTag:function(a,c,b){return queueOp("wave.wavelet.modifyTag",{waveletId:b,waveId:c,name:a})},setTitle:function(a,c,b){return queueOp("wave.wavelet.setTitle",
{waveletId:b,waveId:c,waveletTitle:a})},participant:{add:function(a,c,b){return queueOp("wave.wavelet.participant.add",{waveId:c,waveletId:b,participantId:a})}}},document:{appendMarkup:function(a,c,b,d){return queueOp("wave.document.appendMarkup",{waveletId:d,waveId:b,blipId:c,content:a})},modify:function(a,c,b,d){return queueOp("wave.document.modify",{waveletId:d,waveId:b,blipId:c,modifyAction:a})},modify_range:function(a,c,b,d,f,e){return queueOp("wave.document.modify",{waveletId:e,waveId:f,blipId:d,
modifyAction:a,range:{start:c,end:b}})}},blip:{"delete":function(a,c,b){return queueOp("wave.blip.delete",{waveletId:b,waveId:c,blipId:a})},replace:function(a,c,b,d){return wave.document.modify({modifyHow:"REPLACE",values:["\n"+a]},c,b,d)},replace_range:function(a,c,b,d,f,e){return wave.document.modify_range({modifyHow:"REPLACE",values:[a]},c,b,d,f,e)},update_element:function(a,c,b,d){return queueOp("wave.document.modify",{waveletId:d,waveId:b,blipId:c,modifyAction:{modifyHow:"UPDATE_ELEMENT",elements:[{type:"GADGET",
properties:a}]},modifyQuery:{restrictions:{},maxRes:1,elementMatch:"GADGET"}})},insert:function(a,c,b,d){return wave.document.modify({modifyHow:"INSERT",values:["\n"+a]},c,b,d)},append:function(a,c,b,d){return wave.document.modify({modifyHow:"INSERT_AFTER",values:[a]},c,b,d)},createChild:function(a,c,b,d){return queueOp("wave.blip.createChild",{waveletId:b,waveId:c,blipId:a,blipData:{waveletId:b,blipId:d,waveId:c,content:"",parentBlipId:a}})},continueThread:function(a,c,b,d){return queueOp("wave.blip.continueThread",
{waveletId:b,waveId:c,blipId:a,blipData:{waveletId:b,blipId:d,waveId:c,content:"",parentBlipId:a}})},contentCreateChild:function(a,c,b,d){var f="TBD_"+d+"_0x"+(Math.random()*9E5).toString(16);wave.blip.createChild(c,b,d,f);wave.blip.replace(a,f,b,d)},contentContinueThread:function(a,c,b,d){var f="TBD_"+d+"_0x"+(Math.random()*9E5).toString(16);wave.blip.continueThread(c,b,d,f);wave.blip.replace(a,f,b,d)}}};if(mobilewebkit)document.body.className+=" mobilewebkit";if(!window.onLine)window.onLine=function(){return true};
opt.multipane===undefined&&screen_size>900&&!mobilewebkit&&opt.fn.set("multipane",true);opt.x.multipane="Enable multipane viewing experience (note, you must reload the page for changes to take effect)";
if(opt.multipane){document.getElementById("search_parent").insertBefore(document.getElementById("appheader"),document.getElementById("search_parent").firstChild);document.body.className+=" multipane";document.getElementById("header").innerHTML="&mu;wave";wave_container.innerHTML="<div style='padding:40px'>No waves loaded yet</div>";location.hash.indexOf("search:")==-1&&setTimeout(function(){autosearch("in:inbox");runQueue()},500)}opt.x.no_scrollhistory="Do not save search scroll position and restore to it";
opt.x.old_results="Old results panel style";opt.x.largeFont="Use a larger font";opt.c.largeFont=function(a){document.body.style.fontSize=a==true?"16px":"13px"};prefetched_waves={};unread_blips={};opt.c.largeFont(opt.largeFont);opt.x.prefetch="Prefetch waves and load them, way faster and also not real time";
function addTouchScroll(){var a=arguments,c=document.createElement("link");c.href="js/lib/touchscroll.css";c.type="text/css";c.rel="stylesheet";document.body.appendChild(c);c=document.createElement("script");c.src="js/lib/touchscroll.min.js";c.onload=function(){setTimeout(function(){for(var b=0;b<a.length;b++){var d=a[b];console.log(d);if(typeof d=="string")d=document.getElementById(d);new TouchScroll(d,{elastic:true})}},100)};document.body.appendChild(c)}opt.x.touchscroll="Add the TouchScroll library to do cool scrolly things on iPad Multipane";
if(opt.touchscroll){addTouchScroll("wave_container_parent","search_parent_container");document.getElementById("wave_container_parent").style.width=innerWidth-300+"px";document.getElementById("wave_container").style.width=innerWidth-300+"px"}
function chronological_blip_render(a){var c=[];for(var b in msg.data.blips)c.push(msg.data.blips[b]);c=c.sort(function(f,e){return f.lastModifiedTime-e.lastModifiedTime});var d=c.length-1;(function(){for(var f=Math.max(0,d-10);d>=f;d--){var e=d,g=blip_render(c[e].blipId,a);if(msg.data.blips[c[e].parentBlipId]&&g){var i=document.createElement("blockquote");e=msg.data.blips[c[e].parentBlipId];var h=e.contributors.join(", ").replace(/@googlewave.com/g,"")+":"+e.content;i.innerHTML=h.substr(0,140)+(h.length>
140?"...":"");i.setAttribute("onclick","msg.data.blips['"+e.blipId+"'].dom.scrollIntoView()");g.insertBefore(i,g.getElementsByTagName("div")[0].nextSibling)}}f&&setTimeout(arguments.callee,0)})()}
function recursive_blip_render(a,c){var b=blip_render(a,c),d=msg.data.blips[a];if(d.childBlipIds.length>0){if(d.childBlipIds.length>1){var f=document.createElement("div");f.className="thread";for(var e=1;e<d.childBlipIds.length;e++)recursive_blip_render(d.childBlipIds[e],f);f.childNodes.length!=0&&c.appendChild(f)}recursive_blip_render(d.childBlipIds[0],c)}return b}
function bootstrap_thread_render(a){var c=msg.data.waveletData.rootThread.blipIds,b=c.length,d=0;(function(){for(var f=d+5;d<f&&d<b;)thread_render(c[d++],a);d<b&&setTimeout(arguments.callee,0)})()}
function thread_render(a,c){var b=msg.data.blips[a];if(b)if(!b.dom){var d=blip_render(a,c);b=b.replyThreadIds;var f=b.length;if(f!=0){var e=document.createElement("div");e.className="thread";c.appendChild(e);for(t=0;t<f;t++)for(var g=msg.data.threads[b[t]].blipIds,i=g.length,h=0;h<i;h++)thread_render(g[h],e)}return d}}
function renderBlip(a){for(var c=a.content+" ",b={},d={},f={},e=0;e<a.annotations.length;e++){var g=a.annotations[e];if(g.name.indexOf("user/d/")==0){var i=g.value.split(","),h=g.name.substr(7);if(new Date-parseInt(i[1])<36E5)f[h]="rgb("+Math.floor(205-Math.random()*100).toString()+","+Math.floor(205-Math.random()*100).toString()+","+Math.floor(205-Math.random()*100).toString()+")"}if(b[g.range.start])b[g.range.start].push(e);else b[g.range.start]=[e];if(d[g.range.end])d[g.range.end].push(e);else d[g.range.end]=
[e]}i={};var j=document.createElement("div"),k=null,l=null,p="";for(e=0;e<c.length;e++){if(b[e]||d[e]||a.elements[e]){p&&l.appendChild(document.createTextNode(p));p="";if(a.elements[e]){h=a.elements[e];if(h.type=="INLINE_BLIP")j.appendChild(inline_blip_render(h.properties.id));else if(h.type=="IMAGE"){k=document.createElement("div");k.innerHTML="<b>"+(h.properties.attachmentId||"")+"</b> "+(h.properties.caption||"")+"<br>";if(h.properties.url){var o=document.createElement("img");o.src=h.properties.url;
(function(n){n.onload=function(){if(small_screen&&n.width>screen_size){n.style.width="100%";n.onclick=function(){n.style.width=n.style.width.indexOf("%")==-1?"100%":""}}}})(o);k.appendChild(o)}j.appendChild(k)}else if(h.type=="INSTALLER"){k=document.createElement("div");k.style.border="3px dotted orange";k.style.margin="10px";k.innerHTML="&lt;<b>Extension Installer</b> "+h.properties.manifest+"&gt;";j.appendChild(k)}else if(h.type=="ATTACHMENT"){k=document.createElement("div");k.style.margin="10px";
k.innerHTML="<b>"+h.properties.mimeType+"</b> "+h.properties.caption+"<br>";if(h.properties.mimeType.indexOf("image/")==0){o=document.createElement("img");o.src=h.properties.attachmentUrl;(function(n){n.onload=function(){if(small_screen&&n.width>screen_size){n.style.width="100%";n.onclick=function(){n.style.width=n.style.width.indexOf("%")==-1?"100%":""}}}})(o);k.appendChild(o)}else k.innerHTML+="<a href='"+h.properties.attachmentUrl+"'>Download</a>";j.appendChild(k)}else if(h.type=="GADGET")j.appendChild(renderGadget(h,
a));else h.type!="LINE"&&console.log("unknown element type",h.type,h.properties);k=document.createElement(h.properties.lineType||"p");if(h.properties.indent)k.style.marginLeft=h.properties.indent*20+"px";if(h.properties.alignment)k.style.textAlign={l:"left",c:"center",r:"right"}[h.properties.alignment];h.properties.direction&&k.setAttribute("dir",{l:"ltr",r:"rtl"}[h.properties.alignment]);j.appendChild(k)}if(b[e]){o=b[e];for(var r=o.length;r--;){g=a.annotations[o[r]];i[g.name]||(i[g.name]=[]);i[g.name].push(g.value);
if(g.name.indexOf("user/e/")==0){h=g.name.substr(7);if(f[h]){var q=document.createElement("span");q.className="cursor";q.innerHTML=g.value.replace(/@.+/,"");q.style.backgroundColor=f[h];l.appendChild(q)}}}}if(d[e]){o=d[e];for(r=o.length;r--;){g=a.annotations[o[r]];i[g.name].shift();i[g.name].length==0&&delete i[g.name]}}l=i["link/auto"]||i["link/manual"]||i["link/wave"]?document.createElement("a"):document.createElement("span");k.appendChild(l);for(g in i){h=i[g][0];if(g.indexOf("style/")==0)l.style[g.substr(6)]=
h;else if(g=="conv/title")l.style.fontWeight="bold";else if(g!="spell")if(g!="lang")if(g=="link/manual"||g=="link/auto"){l.href=h;l.target="_blank"}else if(g=="link/wave"){l.href="#wave:"+h;l.setAttribute("onclick","ch(this)")}else g.indexOf("user/e")!=0&&g.indexOf("user/d")!=0&&g.indexOf("user/r")!=0&&console.log("unrecognized annotation",g,h)}}if(c.charAt(e)!="\n")p+=c.charAt(e)}p&&l.appendChild(document.createTextNode(p));return j}var queue=[],callbacks={},id_count=0;
function queueOp(a,c,b){var d=(id_count++).toString();if(b)callbacks[d]=b;queue.push({id:d,method:a,params:c});return d}if(!window.doXHR)window.doXHR=function(a,c){var b=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");b.open("POST","/rpc",true);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){b.readyState==4&&c(b)};b.send(a)};
function runQueue(){if(queue.length==0)return false;for(var a=[],c=0;c<queue.length;c++)a.push(queue[c].id);doXHR(JSON.stringify(queue),function(b){if(b.status==200){var d;try{d=JSON.parse(b.responseText)}catch(f){if(b.responseText.indexOf("Error 401")!=-1){alert("Your login token has expired\n"+b.responseText);return location="/?force_auth=true"}for(var e=0;e<a.length;e++){var g=null,i=a[e];if(callbacks[i]){try{g=callbacks[i]()}catch(h){}delete callbacks[i]}if(!g){alert("There was a server error, please try again. A");
b.responseText&&alert(b.responseText)}}}if(d){console.log(d);for(e=0;e<d.length;e++){i=d[e].id;g=null;if(callbacks[i]){g=callbacks[i](d[e]);delete callbacks[i]}if(d[e].error&&!g){if(d[e].error.code==401){alert("Your login token has expired\n"+b.responseText);return location="/?force_auth=true"}alert("Error "+d[e].error.code+": "+d[e].error.message)}}}}else for(e=0;e<a.length;e++){g=null;i=a[e];if(callbacks[i]){try{g=callbacks[i]()}catch(j){}delete callbacks[i]}if(!g){alert("There was a server error, please try again. B");
b.responseText&&alert(b.responseText)}}});queue=[]}function autosearchbox(){var a=document.forms.searchbox.query.value;a.toLowerCase().indexOf("wave:")==0||a.toLowerCase().indexOf("new:")==0?hashHandler("#"+a,true):hashHandler("#search:"+a,true)}
function autosearch(a){if(a==current_search&&current_page==1&&search_outdated==false){document.getElementById("suggest").style.display="";searchmode(0);current_page=0;search_container.style.display="";opt.no_scrollhistory||scrollTo(0,searchscroll);if(!opt.multipane){wave_container.style.display="none";msg={};wave_container.innerHTML=""}}else{current_search=document.forms.searchbox.query.value=a;update_search()}document.getElementById("floating_menu").style.display="none"}function searchmode(){}
opt.x.recursive_renderer="Use old version of tree wave renderer, only works on Wave Protocol 0.21 or below";opt.x.no_sig="Do not automatically add <i>posted with micro-wave</i> signature";opt.x.owner_utils="Enable utilities for wave creators";opt.x.no_autoscroll="Disable smart autoscroll to latest blip";
function set_user_mode(a){username.replace(/^.+@/,"");msg.data.waveletData.participants.slice(1).forEach(function(c){wave.wavelet.modifyParticipantRole(c,a||"READ_ONLY",current_wave,msg.data.waveletData.waveletId);alert("done setting "+(msg.data.waveletData.participants.length-1)+" people as "+(a||"READ_ONLY"))});runQueue()}
function add_tag(){var a=prompt("Add tag");if(a){wave.wavelet.addTag(a,msg.data.waveletData.waveId,msg.data.waveletData.waveletId);loadWave(msg.data.waveletData.waveId);auto_reload=true;runQueue()}}
function update_search(){current_page=0;var a=loading(current_search);msg={};extend_search(0,function(){loading(a);document.getElementById("suggest").style.display="";search_container.innerHTML="";searchmode(0);search_container.style.display="";if(!opt.multipane){wave_container.style.display="none";wave_container.innerHTML=""}})}function auto_extend(a){a.innerHTML="Loading...";extend_search(searchLastIndex+42,function(){a.parentNode.removeChild(a)});runQueue()}
if(!window.resultClass)window.resultClass=function(){return""};
function extend_search(a,c){searchLastIndex=a;search_outdated=false;callbacks[wave.robot.search(current_search,a||0,42)]=function(b){c&&c();i=b;console.log(i);b="";var d,f=i.data.searchResults.digests;if(opt.prefetch){var e=0;setTimeout(function(){var j=f[e++];if(j){var k=j.waveId.replace(/[\/!].+/,"!conv+root");callbacks[wave.robot.fetchWave(j.waveId,k)]=function(l){if(l)prefetched_waves[j.waveId]=l;return true};runQueue();setTimeout(arguments.callee,500)}},1E3)}for(var g=0;g<f.length;g++){d=f[g];
d.title=d.title.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");d.snippet=d.snippet.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");unread_blips[d.waveId]=d.unreadCount;if(opt.old_results)b+='<a href="#wave:'+d.waveId+'" class="searchlink" onclick=\'ch(this)\'><div class="search"><b>'+d.title+"</b> <span style='color:gray'>"+d.snippet+"</div></a>";else{var i=d.unreadCount>0?"<span class='unread_msg'><span class='bubble'>"+d.unreadCount+"</span> of "+d.blipCount+"</span>":"<span class='read_msg'>"+d.blipCount+
" msgs</span>",h=format_time(d.lastModified);i='<div class="search '+resultClass(d.waveId)+'"><div class="date">'+h+"<br>"+i+'</div><span class="title_'+(d.unreadCount>0?"unread":"read")+'">'+d.title+"</span> <span class='snippet'>"+d.snippet+"</span></div>";b+=d.waveId.indexOf("treq")!=-1?'<a class="searchlink">'+i+"</a>":'<a href="#wave:'+d.waveId+'" class="searchlink" onclick=\'ch(this)\'>'+i+"</a>"}}search_container.innerHTML+=b;search_container.innerHTML+=f.length<42?f.length==0?current_search.indexOf("is:unread")!=
-1?"<div class='footer'><b>Yay</b>, no unread items!</div>":"<div class='footer'>Your search query has <b>zero results</b>. Try broaden your search?</div>":"<div class='footer'><b>Hooray!</b> You've reached the end of the universe!</div>":'<div class="footer" onclick="auto_extend(this);"><b>Extend</b> Search (Page '+(a/42+1)+")</div>"}}function ch(a){hashHandler(a.href.substr(a.href.indexOf("#")),true)}
function hashHandler(a,c){var b=lasthash;lasthash=a;if(a.charAt(0)=="#")a=unescape(a.substr(1));if(!(unescape("#"+a)==unescape(b)&&!c)){if(unescape(unescape(unescape(location.hash)))!="#"+unescape(unescape(unescape(a))))location.hash="#"+unescape(unescape(a));if(a.indexOf("search:")==0){autosearch(a.substr(7));runQueue()}else if(a.indexOf("wave:")==0){loadWave(a.substr(5));runQueue()}else a.toLowerCase().indexOf("new:wave")==0&&create_wave()}}
typeof window.onhashchange=="undefined"&&setInterval(function(){window.onhashchange()},100);window.onhashchange=function(){hashHandler(location.hash)};var chronological_blips=[];
function loadWave(a,c){var b=loading(a);if(onLine()==false)return window.offline_loadWave(a);a=a.replace("/","!");c=c||a.replace(/[\/!].+/,"!conv+root");var d=function(f){loading(b);console.log(f);window.msg=f;if(msg.error)if(msg.error.message.indexOf("not a participant")!=-1){alert("You are not a participant of the wave/wavelet. ");return true}else return false;if(f.data.waveletData){searchmode(1);if(!opt.multipane)search_container.style.display="none";current_page=1;wave_container.style.display=
"";window.onscroll();document.getElementById("floating_menu").style.display="";if(!opt.no_autoscroll){if(Object.keys)var e=Object.keys(msg.data.blips);else{e=[];for(var g in msg.data.blips)e.push(g)}chronological_blips=e.sort(function(i,h){return msg.data.blips[h].lastModifiedTime-msg.data.blips[i].lastModifiedTime})}scrollto_position=-1;if(!auto_reload)if(!opt.no_scrollhistory){scrollTo(0,0);if(!opt.no_autoscroll)if(unread_blips[a])scrollto_position=unread_blips[a]}auto_reload=false;if(!opt.multipane)document.getElementById("suggest").style.display=
"none";wave_container.innerHTML="";if(opt.owner_utils&&msg.data.waveletData.participants[0]==username)wave_container.innerHTML+='<div><button onclick="set_user_mode()">Everyone Read Only</button><button onclick="set_user_mode(\'FULL\')">Everyone Full Access</button></div>';e=document.createElement("div");e.className="wavelet";g=document.createElement("a");g.innerHTML=" Add";g.className="addparticipant";g.style["float"]="right";g.href="javascript:void(0)";g.onclick=function(){var i=prompt("Enter Participant ID to Add");
if(i){if(i.indexOf("@")==-1)i+="@googlewave.com";wave.wavelet.participant.add(i,a,c);loadWave(a);auto_reload=true;runQueue()}};e.appendChild(g);e.appendChild(userList(f.data.waveletData.participants));wave_container.appendChild(e);current_wave=a=a.replace(/\s/,"");current_wavelet=c;e=document.createElement("div");wave_container.appendChild(e);if(document.getElementById("chronos").checked)chronological_blip_render(e);else opt.recursive_renderer||!msg.data.waveletData.rootThread?recursive_blip_render(msg.data.waveletData.rootBlipId,
e):bootstrap_thread_render(e);e=document.createElement("div");f=f.data.waveletData.tags.join(", ");if(f.length==0)f="(None)";e.innerHTML="<b>Tags:</b> ";e.appendChild(document.createTextNode(f));e.innerHTML+=' <a href="javascript:add_tag()" style="float:right">Add</a>';e.className="tags";wave_container.appendChild(e);f=document.createElement("div");f.innerHTML='<a href="https://wave.google.com/wave/#restored:wave:'+escape(escape(a))+'" target="_blank">Open this wave in the official wave client</a>';
f.className="footer";wave_container.appendChild(f);wave_container.appendChild(document.createElement("br"))}else alert("The server sent nothing")};if(opt.prefetch&&prefetched_waves[a])d(JSON.parse(JSON.stringify(prefetched_waves[a])));else callbacks[wave.robot.fetchWave(a,c)]=d}if(!this.JSON)this.JSON={};
(function(){function a(j){return j<10?"0"+j:j}function c(j){f.lastIndex=0;return f.test(j)?'"'+j.replace(f,function(k){var l=i[k];return typeof l==="string"?l:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+j+'"'}function b(j,k){var l,p,o,r,q=e,n,m=k[j];if(m&&typeof m==="object"&&typeof m.toJSON==="function")m=m.toJSON(j);if(typeof h==="function")m=h.call(k,j,m);switch(typeof m){case "string":return c(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";e+=g;n=[];if(Object.prototype.toString.apply(m)==="[object Array]"){r=m.length;for(l=0;l<r;l+=1)n[l]=b(l,m)||"null";o=n.length===0?"[]":e?"[\n"+e+n.join(",\n"+e)+"\n"+q+"]":"["+n.join(",")+"]";e=q;return o}if(h&&typeof h==="object"){r=h.length;for(l=0;l<r;l+=1){p=h[l];if(typeof p==="string")if(o=b(p,m))n.push(c(p)+(e?": ":":")+o)}}else for(p in m)if(Object.hasOwnProperty.call(m,p))if(o=b(p,m))n.push(c(p)+(e?": ":":")+o);o=n.length===0?"{}":e?"{\n"+e+n.join(",\n"+e)+
"\n"+q+"}":"{"+n.join(",")+"}";e=q;return o}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,g,i={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(j,k,l){var p;g=e="";if(typeof l==="number")for(p=0;p<l;p+=1)g+=" ";else if(typeof l==="string")g=l;if((h=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return b("",
{"":j})};if(typeof JSON.parse!=="function")JSON.parse=function(j,k){function l(o,r){var q,n,m=o[r];if(m&&typeof m==="object")for(q in m)if(Object.hasOwnProperty.call(m,q)){n=l(m,q);if(n!==undefined)m[q]=n;else delete m[q]}return k.call(o,r,m)}var p;j=String(j);d.lastIndex=0;if(d.test(j))j=j.replace(d,function(o){return"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(j.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){p=eval("("+j+")");return typeof k==="function"?l({"":p},""):p}throw new SyntaxError("JSON.parse");}})();function startup(){wave.robot.notifyCapabilitiesHash();getUsername();location.hash.length<2?hashHandler("#search:in:inbox"):hashHandler(location.hash)}function auto_start(){window.NO_STARTUP||startup();window.offline_cache&&setTimeout(offline_cache,1337)}setTimeout(auto_start,0);
