window.opt||(opt={});opt.x=opt.x||{};opt.c=opt.c||{};
opt.fn={_el:0,parse:function(a){if(a=="false")return false;if(a=="true")return true;if(parseFloat(a).toString()==a)return parseFloat(a);return a},init:function(){var a=window.location.search.substr(1).split("&");if(window.localStorage)for(var c=0;c<localStorage.length;c++){var b=localStorage.key(c);if(b.indexOf("opt_")==0&&b.length)window.opt[b.substr(4)]=window.opt.fn.parse(localStorage[b])}for(b=0;b<a.length;b++){c=a[b].split("=");window.opt[c[0]]=c[1]?c[1]:true}},close:function(){if(opt.fn._el)try{opt.fn._el.parentNode.removeChild(opt.fn._el)}catch(a){}opt.fn._el=
0},show:function(){opt.fn.close();var a=opt.fn._el=document.createElement("div"),c='<div style="padding:7px;padding-bottom:100px;"><h1 onclick="opt.fn.close()">'+(opt.appName||"")+" settings</h1>";for(var b in opt.x)c+='<input type="checkbox" name="'+b+'" id="'+b+'" '+(opt[b]?"checked":"")+' onchange="opt.fn.handleBoolean(this)"> <label for="'+b+'">'+opt.x[b]+" <i>("+b+")</i></label><br>";c+='<br><button onclick="opt.fn.close()">Exit settings</button></div>';a.innerHTML=c;a.style.position="absolute";
a.style.top=0;a.style.left=0;a.style.width="100%";a.style.backgroundColor="#fff";a.style.padding="0";a.style.zIndex=99999999;a.onclick=function(e){e=e||window.event;(e.target||e.srcElement).tagName.toLowerCase()=="div"&&window.opt.fn.close()};document.body.appendChild(a)},handleBoolean:function(a){opt.fn.set(a.name,a.checked)},set:function(a,c){if(typeof opt.c[a]=="function")c=opt.c[a](c)||c;opt[a]=c;if(window.localStorage)localStorage["opt_"+a]=c.toString()}};opt.fn.init();
var TouchScroll=function(){function a(d,f,i,l){if(!(d>=0&&d<=1))throw new RangeError("'p1x' must be a number between 0 and 1. Got "+d+"instead.");if(!(f>=0&&f<=1))throw new RangeError("'p1y' must be a number between 0 and 1. Got "+f+"instead.");if(!(i>=0&&i<=1))throw new RangeError("'p2x' must be a number between 0 and 1. Got "+i+"instead.");if(!(l>=0&&l<=1))throw new RangeError("'p2y' must be a number between 0 and 1. Got "+l+"instead.");this._p1={x:d,y:f};this._p2={x:i,y:l}}function c(d){d.style.webkitTransformStyle=
"preserve-3d";d.style.webkitTransitionProperty="-webkit-transform"}function b(d,f,i,l){var o=d.style;if(i!=null)o.webkitTransitionDuration=i+"";if(l!=null)o.webkitTransitionTimingFunction=l+"";d.style.webkitTransform="translate("+f.e+"px, "+f.f+"px)"}function e(d){if(d.touches&&d.touches.length)d=d.touches[0];var f=new WebKitCSSMatrix;f.e=d.pageX;f.f=d.pageY;return f}function g(d){d.e=Math.round(d.e);d.f=Math.round(d.f);return d}function h(d,f){f=f||{};this.elastic=!!f.elastic;this.scrollers={container:d,
outer:null,inner:null,e:null,f:null};this._scrolls={e:false,f:false};this._scrollMin={e:false,f:false};this._scrollbars=null;this._isScrolling=false;this._startEvent=null;this._currentOffset=new WebKitCSSMatrix;this._trackedEvents=null;this._flicking={e:false,f:false};this._bounces={e:null,f:null};this._animationTimeouts={e:[],f:[]};this._initDom();this.setupScroller()}var j={threshold:5,scrollHandleMinSize:25,flicking:{triggerThreshold:150,friction:0.998,minSpeed:0.15,timingFunc:[0,0.3,0.6,1]},elasticity:{factorDrag:0.5,
factorFlick:0.2,max:100},snapBack:{timingFunc:[0.4,0,1,1],defaultTime:400,alwaysDefaultTime:true}};a.prototype._getCoordinateForT=function(d,f,i){var l=3*f;f=3*(i-f)-l;return(((1-l-f)*d+f)*d+l)*d};a.prototype._getCoordinateDerivateForT=function(d,f,i){var l=3*f;f=3*(i-f)-l;return(3*(1-l-f)*d+2*f)*d+l};a.prototype._getTForCoordinate=function(d,f,i,l){if(!isFinite(l)||l<=0)throw new RangeError("'epsilon' must be a number greater than 0.");for(var o=d,s=0,u,t;s<8;s++){u=this._getCoordinateForT(o,f,i)-
d;if(Math.abs(u)<l)return o;t=this._getCoordinateDerivateForT(o,f,i);if(Math.abs(t)<1.0E-6)break;o-=u/t}o=d;s=0;t=1;if(o<s)return s;if(o>t)return t;for(;s<t;){u=this._getCoordinateForT(o,f,i);if(Math.abs(u-d)<l)return o;if(d>u)s=o;else t=o;o=(t-s)*0.5+s}return o};a.prototype.getPointForT=function(d){if(d==0||d==1)return{x:d,y:d};else if(!(d>0)||!(d<1))throw new RangeError("'t' must be a number between 0 and 1Got "+d+" instead.");return{x:this._getCoordinateForT(d,this._p1.x,this._p2.x),y:this._getCoordinateForT(d,
this._p1.y,this._p2.y)}};a.prototype.getTforX=function(d,f){return this._getTForCoordinate(d,this._p1.x,this._p2.x,f)};a.prototype.getTforY=function(d,f){return this._getTForCoordinate(d,this._p1.y,this._p2.y,f)};a.prototype._getAuxPoints=function(d){if(!(d>0)||!(d<1))throw new RangeError("'t' must be greater than 0 and lower than 1");var f={x:d*this._p1.x,y:d*this._p1.y},i={x:this._p1.x+d*(this._p2.x-this._p1.x),y:this._p1.y+d*(this._p2.x-this._p1.y)},l={x:this._p2.x+d*(1-this._p2.x),y:this._p2.y+
d*(1-this._p2.y)},o={x:f.x+d*(i.x-f.x),y:f.y+d*(i.y-f.y)},s={x:i.x+d*(l.x-i.x),y:i.y+d*(l.y-i.y)};return{i0:f,i1:i,i2:l,j0:o,j1:s,k:{x:o.x+d*(s.x-o.x),y:o.y+d*(s.y-o.y)}}};a.prototype.divideAtT=function(d){if(d<0||d>1)throw new RangeError("'t' must be a number between 0 and 1. Got "+d+" instead.");if(d===0||d===1){var f=[];f[d]=a.linear();f[1-d]=this.clone();return f}f={};var i={},l=this._getAuxPoints(d);d=l.i0;var o=l.i2,s=l.j0,u=l.j1,t=l.k;l=t.x;t=t.y;f.p1={x:d.x/l,y:d.y/t};f.p2={x:s.x/l,y:s.y/
t};i.p1={x:(u.x-l)/(1-l),y:(u.y-t)/(1-t)};i.p2={x:(o.x-l)/(1-l),y:(o.y-t)/(1-t)};return[new a(f.p1.x,f.p1.y,f.p2.x,f.p2.y),new a(i.p1.x,i.p1.y,i.p2.x,i.p2.y)]};a.prototype.divideAtX=function(d,f){if(d<0||d>1)throw new RangeError("'x' must be a number between 0 and 1. Got "+d+" instead.");return this.divideAtT(this.getTforX(d,f))};a.prototype.divideAtY=function(d,f){if(d<0||d>1)throw new RangeError("'y' must be a number between 0 and 1. Got "+d+" instead.");return this.divideAtT(this.getTforY(d,f))};
a.prototype.clone=function(){return new a(this._p1.x,this._p1.y,this._p2.x,this._p2.y)};a.prototype.toString=function(){return"cubic-bezier("+[this._p1.x,this._p1.y,this._p2.x,this._p2.y].join(", ")+")"};a.linear=function(){return new a};a.ease=function(){return new a(0.25,0.1,0.25,1)};a.linear=function(){return new a(0,0,1,1)};a.easeIn=function(){return new a(0.42,0,1,1)};a.easeOut=function(){return new a(0,0,0.58,1)};a.easeInOut=function(){return new a(0.42,0,0.58,1)};var m=function(){if("createTouch"in
document)return true;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(d){return false}}(),k=function(){var d=new WebKitCSSMatrix("matrix(1, 0, 0, 1, -20, -30)");return d.e==-20&&d.f==-30}(),n;n=m?{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}:{start:"mousedown",move:"mousemove",end:"mouseup",cancel:"touchcancel"};var p;if(k)p=function(d){d=window.getComputedStyle(d).webkitTransform;return new WebKitCSSMatrix(d)};else{var q=/matrix\(\s*-?\d+(?:\.\d+)?\s*,\s*-?\d+(?:\.\d+)?\s*,\s*-?\d+(?:\.\d+)?\s*,\s*-?\d+(?:\.\d+)?\s*\,\s*(-?\d+(?:\.\d+)?)\s*,\s*(-?\d+(?:\.\d+)?)\s*\)/;
p=function(d){var f=window.getComputedStyle(d).webkitTransform;d=new WebKitCSSMatrix;if(f=q.exec(f)){d.e=f[1];d.f=f[2]}return d}}var r=document.createElement("div");r.innerHTML='<div class="touchScrollTrack touchScrollTrackX"><div class="touchScrollHandle"></div></div><div class="touchScrollTrack touchScrollTrackY"><div class="touchScrollHandle"></div></div>';h.handleEvent=function(d){var f=this.prototype.currentScroller;if(f)f.handleEvent(d);else d.type===n.move&&d.preventDefault()};document.addEventListener(n.move,
h,false);document.addEventListener(n.end,h,false);document.addEventListener(n.cancel,h,false);h.prototype={currentScroller:null,handlerNames:{resize:"setupScroller",orientationchange:"setupScroller",webkitTransitionEnd:"onTransitionEnd",DOMSubtreeModified:"setupScroller",touchstart:"onTouchStart",mousedown:"onTouchStart",touchmove:"onTouchMove",mousemove:"onTouchMove",touchend:"onTouchEnd",mouseup:"onTouchEnd",touchcancel:"onTouchEnd"},_initDom:function(){var d=document.createElement("div"),f=d.cloneNode(false),
i=this.scrollers.container;d.className="touchScrollInner";i.className+=" touchScroll";for(var l=0,o=i.childNodes.length;l<o;l++)d.appendChild(i.firstChild);f.appendChild(d);i.appendChild(f);this.scrollers.outer=this.scrollers.f=f;this.scrollers.inner=this.scrollers.e=d;c(f);c(d);d.style.display="inline-block";d.style.minWidth="100%";d.style.webkitBoxSizing="border-box";d=r.cloneNode(true);l=d.querySelector(".touchScrollTrackX");o=d.querySelector(".touchScrollTrackY");var s=l.firstElementChild,u=o.firstElementChild,
t=d.style;t.pointerEvents="none";t.webkitTransitionProperty="opacity";t.webkitTransitionDuration="250ms";t.opacity="0";this._scrollbars={container:d,tracks:{e:l,f:o},handles:{e:s,f:u},sizes:{e:0,f:0}};c(s);c(u);i.insertBefore(d,f);if(window.getComputedStyle(i).position=="static")i.style.position="relative";this.setupScroller();i.addEventListener(n.start,this,false);f.addEventListener("webkitTransitionEnd",this,false);f.addEventListener("DOMSubtreeModified",this,true);window.addEventListener("orientationchange",
this,false);window.addEventListener("resize",this,false)},setupScroller:function(){var d=this.scrollers.outer.parentNode;d={e:d.offsetWidth,f:d.offsetHeight};var f=this.scrollers.inner;f={e:f.offsetWidth,f:f.offsetHeight};var i=this._scrollbars,l={e:Math.min(d.e-f.e,0),f:Math.min(d.f-f.f,0)};i.container.style.height=d.f+"px";this._scrollMin=l;var o=this._scrolls={e:l.e<0,f:l.f<0};this._doScroll=o.e||o.f;i.container.className="touchScrollBars";if(o.e&&o.f)i.container.className+=" touchScrollBarsBoth";
i.tracks.e.style.display=o.e?"":"none";i.tracks.f.style.display=o.f?"":"none";var s={e:i.tracks.e.offsetWidth,f:i.tracks.f.offsetHeight};i.sizes={e:Math.round(Math.max(s.e*d.e/f.e,j.scrollHandleMinSize)),f:Math.round(Math.max(s.f*d.f/f.f,j.scrollHandleMinSize))};i.handles.e.style.width=i.sizes.e+"px";i.handles.f.style.height=i.sizes.f+"px";i.maxOffsets={e:s.e-i.handles.e.offsetWidth,f:s.f-i.handles.f.offsetHeight};i.offsetRatios={e:o.e?(s.e-i.handles.e.offsetWidth)/l.e:0,f:o.f?(s.f-i.handles.f.offsetHeight)/
l.f:0}},handleEvent:function(d){var f=this.handlerNames[d.type];f&&this[f](d)},onTouchStart:function(d){if(this._doScroll){this.__proto__.currentScroller=this;this._isScrolling=false;this._trackedEvents=[];this._determineOffset();this._trackEvent(d);this._startEventTarget=d.target;this._stopAnimations();this._startEvent=d;d.stopPropagation();d.preventDefault()}},onTouchMove:function(d){if(this._doScroll){var f=this._trackedEvents[1].matrix;f=e(d).translate(-f.e,-f.f,0);var i=this._isScrolling,l=i;
d.stopPropagation();d.preventDefault();if(!l){l=j.threshold;l=f.e<=-l||f.e>=l||f.f<=-l||f.f>=l}if(l){if(!i){this._isScrolling=true;this.showScrollbars()}this._scrollBy(f);this._trackEvent(d)}}},onTouchEnd:function(d){var f=this._startEventTarget;if(!this._isScrolling&&f==d.target){for(f=d.target;f.nodeType!=1;)f=f.parentNode;var i=document.createEvent("HTMLEvents");i.initEvent("focus",false,false);f.dispatchEvent(i);i=document.createEvent("MouseEvent");i.initMouseEvent("click",true,true,d.view,1,
d.screenX,d.screenY,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,null);f.dispatchEvent(i)}else if(this._isScrolling){i=this._getLastMove();if(i.duration<=j.flicking.triggerThreshold&&i.length){d=this._getFlickingDuration(i.speed);var l=this._getFlickingLength(i.speed,d);f=i.matrix;i=l/i.length;f.e*=i;f.f*=i;this.startFlick(f,d)}}this.isAnimating()||this._snapBack()||this.hideScrollbars();delete this._startEventTarget;this._isScrolling=false;this.__proto__.currentScroller=null},
onTransitionEnd:function(d){["e","f"].forEach(function(f){if(d.target===this.scrollers[f])this._flicking[f]=false},this);this.isAnimating()||this.hideScrollbars()},isAnimating:function(){var d=this._animationTimeouts,f=this._flicking.e||this._flicking.f;return d.e.length>0||d.f.length>0||f},scrollBy:function(d,f){this._stopAnimations();var i=new WebKitCSSMatrix;i.e=-d;i.f=-f;return this._scrollBy(i)},scrollTo:function(d,f){this._stopAnimations();var i=this._scrollMin,l=new WebKitCSSMatrix;l.e=Math.min(0,
Math.max(i.e,-d));l.f=Math.min(0,Math.max(i.f,-f));d=this._currentOffset;l.e-=d.e;l.f-=d.f;return this._scrollBy(l)},center:function(){return this.scrollTo(-Math.round(this._scrollMin.e/2),-Math.round(this._scrollMin.f/2))},_scrollBy:function(d){var f=this._scrolls;if(!f.e)d.e=0;if(!f.f)d.f=0;var i=this._scrollMin,l=this._currentOffset;f=l.multiply(d);var o={e:false,f:false},s={e:0,f:0};if(this.elastic){var u=j.elasticity.factorDrag,t={e:l.e<i.e||l.e>0,f:l.f<i.f||l.f>0};if(t.e)f.e-=d.e*(1-u);if(t.f)f.f-=
d.f*(1-u);if(f.e<i.e||f.e>0){o.e=true;s.e=f.e>=0?f.e:i.e-f.e}if(f.f<i.f||f.f>0){o.f=true;s.f=f.f>=0?f.f:i.f-f.f}d={e:(!t.e||!o.e)&&(o.e||o.e),f:(!t.f||!o.f)&&(o.f||o.f)};if(d.e)if(l.e>0)f.e/=u;else if(f.e>0)f.e*=u;else if(l.e<i.e)f.e+=(i.e-l.e)/u;else if(f.e<i.e)f.e-=(i.e-f.e)*u;if(d.f)if(l.f>0)f.f/=u;else if(f.f>0)f.f*=u;else if(l.f<i.f)f.f+=(i.f-l.f)/u;else if(f.f<i.f)f.f-=(i.f-f.f)*u}else{if(f.e<i.e)f.e=i.e;else if(f.e>0)f.e=0;if(f.f<i.f)f.f=i.f;else if(f.f>0)f.f=0}this._currentOffset=f;d=f.translate(0,
0,0);i=f.translate(0,0,0);d.f=i.e=0;b(this.scrollers.e,d);b(this.scrollers.f,i);l=this._scrollbars.offsetRatios;d.e*=l.e;i.f*=l.f;o.e?this._squeezeScrollbar("e",s.e,f.e<0):b(this._scrollbars.handles.e,d);o.f?this._squeezeScrollbar("f",s.f,f.f<0):b(this._scrollbars.handles.f,i)},_trackEvent:function(d){var f=this._trackedEvents;f[0]=f[1];f[1]={matrix:e(d),timeStamp:d.timeStamp}},showScrollbars:function(){var d=this._scrollbars.container.style;d.webkitTransitionDuration="";d.opacity="1"},hideScrollbars:function(){var d=
this._scrollbars.container.style;d.webkitTransitionDuration="250ms";d.opacity="0"},_squeezeScrollbar:function(d,f,i,l,o){var s=this._scrollbars,u=s.handles[d].style,t=s.sizes[d];f=Math.max(t-f,1);var v=new WebKitCSSMatrix;v[d]=i?s.maxOffsets[d]:0;v[d=="f"?"d":"a"]=f/t;u.webkitTransformOrigin=i?"100% 100%":"0 0";u.webkitTransitionProperty="-webkit-transform";u.webkitTransform=v;if(l){u.webkitTransitionDuration=l+"ms";u.webkitTransitionTimingFunction=o;this._animationTimeouts[d].push(setTimeout(function(){u.webkitTransitionDuration=
""},l))}else u.webkitTransitionDuration=""},_determineOffset:function(d){var f=p(this.scrollers.e),i=p(this.scrollers.f);f=f.multiply(i);d&&g(f);this._currentOffset=f},_stopAnimations:function(){var d=false,f=this._scrollbars;["e","f"].forEach(function(i){this.scrollers[i].style.webkitTransitionDuration="";var l=f.handles[i];l.style.webkitTransitionDuration="";c(l);f.tracks[i].style.webkitBoxPack="";i=this._animationTimeouts[i];d=d||i.length;i.forEach(function(o){clearTimeout(o)});i.length=0},this);
this._determineOffset(true);this._scrollBy(new WebKitCSSMatrix);this._bounces.e=this._bounces.f=null;return d},_getLastMove:function(){var d=this._trackedEvents,f=d[0],i=d[1];if(!f)return{duration:0,matrix:new WebKitCSSMatrix,length:0,speed:0};d=i.timeStamp-f.timeStamp;f=i.matrix.multiply(f.matrix.inverse());i=Math.sqrt(f.e*f.e+f.f*f.f);return{duration:d,matrix:f,length:i,speed:i/d}},_getFlickingDuration:function(d){d=Math.log(j.flicking.minSpeed/d)/Math.log(j.flicking.friction);return d>0?Math.round(d):
0},_getFlickingLength:function(d,f){f=(1-Math.pow(j.flicking.friction,f+1))/(1-j.flicking.friction);return d*f},startFlick:function(d,f){if(f){var i=1/f,l=j.flicking.timingFunc,o=new a(l[0],l[1],l[2],l[3]),s=this._scrollMin,u=this._currentOffset,t=this._scrollbars;g(d);if(!this._scrolls.e)d.e=0;if(!this._scrolls.f)d.f=0;var v=this._currentOffset.multiply(d);["e","f"].forEach(function(w){var B=d[w],x=v[w],A=1;if(x<s[w])A=1-Math.max(Math.min((x-s[w])/d[w],1),0);else if(x>0)A=1-Math.max(Math.min((x-
0)/d[w],1),0);var y=A*B;B-=y;if(y||B){x=o.getTforY(A,i);A=o.getPointForT(x).x;var C=o.divideAtT(x),z=new WebKitCSSMatrix;z[w]=u[w];x=A*f;if(y&&A){this._flicking[w]=true;z[w]+=y;b(this.scrollers[w],z,x+"ms",C[0]);y=z.translate(0,0,0);y[w]*=t.offsetRatios[w];b(t.handles[w],y,x+"ms",C[0])}if(this.elastic&&B){y=z.translate(0,0,0);C=C[1];C._p2={x:1-j.snapBack.timingFunc[0],y:1-j.snapBack.timingFunc[1]};z=Math.min(j.elasticity.factorFlick,j.elasticity.max/Math.abs(B));y[w]+=B*z;var D=(1-A)*f*z;this._bounces[w]=
{timingFunc:C,duration:D+"ms",matrix:y,bounceLength:Math.abs(B*z)};var F=this,E=this._animationTimeouts[w];E.push(setTimeout(function(){F._playQueuedBounce(w)},x));E.push(setTimeout(function(){F._snapBack(w,j.snapBack.alwaysDefaultTime?null:D);E.length=0},x+D))}}else this._snapBack(w)},this)}},_playQueuedBounce:function(d){var f=this._bounces[d];if(f){var i=f.matrix,l=f.duration,o=f.timingFunc;b(this.scrollers[d],i,l,o);this._squeezeScrollbar(d,f.bounceLength,i[d]<0,l,o);this._bounces[d]=null;return true}return false},
_snapBack:function(d,f){if(d==null){d=this._snapBack("e",f);f=this._snapBack("f",f);return d||f}f=f||j.snapBack.defaultTime;var i=this.scrollers[d],l=p(i),o=j.snapBack.timingFunc;o=new a(o[0],o[1],o[2],o[3]);if(l[d]<this._scrollMin[d]||l[d]>0){l[d]=Math.max(Math.min(l[d],0),this._scrollMin[d]);this._squeezeScrollbar(d,0,l[d]<0,f,o);b(i,l,f+"ms",o);return true}return false}};return h}();window.console||(console={log:function(){}});function getEl(a){return document.getElementById(a)}
var screen_size=document.documentElement.clientWidth||innerWidth,small_screen=screen_size<500,loadIds={},current_search="",searchLastIndex=0,edit_box,edit_text,search_container=getEl("search_container"),wave_container=getEl("wave_container"),mobilewebkit=navigator.userAgent.indexOf("WebKit")!=-1&&navigator.userAgent.indexOf("Mobile")!=-1,current_wave="",current_wavelet="",auto_reload=false,lasthash="chunkybacon",current_page=0,search_outdated=false,searchscroll=0,scrollto_position=-1;
if(mobilewebkit)document.body.className+=" mobilewebkit";if(!window.onLine)window.onLine=function(){return true};small_screen=true;var oauth_key,oauth_secret;oauth_key=localStorage.getItem("oauth_key");oauth_secret=localStorage.getItem("oauth_secret");opt.offline==undefined&&opt.fn.set("offline",true);function logoff(){logoff_ui();localStorage.setItem("oauth_secret","");localStorage.setItem("oauth_key","")}
function finish_setup(){var a=trim(getEl("login_code_box").value.toLowerCase()),c=new XMLHttpRequest;c.open("GET","http://micro-wave.appspot.com/app/get_token?code="+a,true);c.onreadystatechange=function(){if(c.status==200&&c.readyState==4)if(c.responseText.indexOf(";")!=-1){getEl("login_error").innerHTML=c.responseText+";"+c.status+";"+c.readyState;getEl("login_error").style.display="";var b=c.responseText.split(";");oauth_key=b[0];localStorage.setItem("oauth_key",oauth_key);oauth_secret=b[1];localStorage.setItem("oauth_secret",
oauth_secret);logon_ui();startup()}else getEl("login_error").style.display=""};c.send(null)}function trim(a){return a.replace(/^\s+|\s+$/g,"")}var last_text="";setTimeout(function(){if(!(oauth_key&&oauth_secret)){var a=trim(getEl("login_code_box").value.toLowerCase());if(last_text!=a)getEl("login_error").style.display="none";last_text=a;if(/^[a-z]{3}\d\d[a-z]{3}$/.test(a))getEl("login_button").style.display="";else getEl("login_button").style.display="none";setTimeout(arguments.callee,100)}});
if(!oauth_key||!oauth_secret){window.NO_STARTUP=true;setTimeout(function(){getEl("content").style.display="none";getEl("appheader").style.display="none";getEl("login").style.display="";getEl("loading").style.display="none"},200)}
window.doXHR=function(a,c){if(!oauth_key||!oauth_secret)return console.log("operation cancelled. no keys.");var b=new XMLHttpRequest;b.open("POST","https://www-opensocial.googleusercontent.com/api/rpc",true);b.setRequestHeader("Content-Type","application/json");b.setRequestHeader("Authorization",to_header(create_signature()));b.onreadystatechange=function(){console.log(b.readyState,b.status,b.responseText,b.statusText);b.readyState==4&&c(b)};b.send(a)};
function create_signature(){var a=Math.random().toString(36).substr(2,5),c=oauth_key,b=oauth_secret,e=[];a={consumer_key:"anonymous",nonce:a,signature_method:"HMAC-SHA1",timestamp:-~(new Date/1E3),token:c};for(var g in a)e.push("oauth_"+g+"="+oauth_escape(a[g]));a.signature=b64_hmac_sha1(oauth_escape("anonymous")+"&"+oauth_escape(b),["POST",oauth_escape("https://www-opensocial.googleusercontent.com/api/rpc"),oauth_escape(e.join("&"))].join("&"));return a}
function to_header(a){var c=[];for(var b in a)c.push("oauth_"+b+'="'+oauth_escape(a[b])+'"');return"OAuth "+c.join(", ")}function to_url(a){var c=[];for(var b in a)c.push("oauth_"+b+"="+oauth_escape(a[b]));return c.join("&")}function oauth_escape(a){return encodeURIComponent(a).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}
function b64_hmac_sha1(a,c,b,e){function g(m,k){var n=(m&65535)+(k&65535);return(m>>16)+(k>>16)+(n>>16)<<16|n&65535}function h(m,k){m[k>>5]|=128<<24-k%32;m[(k+64>>9<<4)+15]=k;for(var n=[80],p=1732584193,q=-271733879,r=-1732584194,d=271733878,f=-1009589776,i=0;i<m.length;i+=16){for(var l=p,o=q,s=r,u=d,t=f,v=0;v<80;v++){n[v]=v<16?m[i+v]:(n[v-3]^n[v-8]^n[v-14]^n[v-16])<<1|(n[v-3]^n[v-8]^n[v-14]^n[v-16])>>>31;var w=g(g(p<<5|p>>>27,v<20?q&r|~q&d:v<40?q^r^d:v<60?q&r|q&d|r&d:q^r^d),g(g(f,n[v]),v<20?1518500249:
v<40?1859775393:v<60?-1894007588:-899497514));f=d;d=r;r=q<<30|q>>>2;q=p;p=w}p=g(p,l);q=g(q,o);r=g(r,s);d=g(d,u);f=g(f,t)}return[p,q,r,d,f]}function j(m){for(var k=[],n=(1<<e)-1,p=0;p<m.length*e;p+=e)k[p>>5]|=(m.charCodeAt(p/8)&n)<<32-e-p%32;return k}b||(b="=");e||(e=8);return function(m){for(var k="",n=0;n<m.length*4;n+=3)for(var p=(m[n>>2]>>8*(3-n%4)&255)<<16|(m[n+1>>2]>>8*(3-(n+1)%4)&255)<<8|m[n+2>>2]>>8*(3-(n+2)%4)&255,q=0;q<4;q++)k+=n*8+q*6>m.length*32?b:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>
6*(3-q)&63);return k}(function(m,k){var n=j(m);if(n.length>16)n=h(n,m.length*e);for(var p=[16],q=[16],r=0;r<16;r++){p[r]=n[r]^909522486;q[r]=n[r]^1549556828}n=h(p.concat(j(k)),512+k.length*e);return h(q.concat(n),672)}(a,c))}function searchStyle(a){if(cacheState[a]==2)return"fresh_cache";else if(cacheState[a]==1)return"old_cache";return""}
function onLine(){var a;a=opt.force_offline?false:navigator.onLine===undefined?true:navigator.onLine;if(a==false){var c=(+new Date-parseInt(localStorage.getItem("cache_last_updated")))/1E3;if(!isNaN(c)){var b="";b=c<90?"a minute":c<3600?Math.ceil(c/60)+" minutes":c<86400?Math.ceil(c/60/60)+" hours":Math.ceil(c/60/60/24)+" days";getEl("offline_status").value="Offline (Cache "+b+" old)"}}return a}var cachequeue=[],db=null;
function open_db(){if(!window.db&&window.openDatabase)window.db=openDatabase("waves","1.0","Offline Wave Cache",1048576)}function offline_cache(){if(onLine()!=false){open_db();if(window.db){db.transaction(function(a){a.executeSql("DROP TABLE inbox")});localStorage.setItem("cache_last_updated",+new Date);callbacks[wave.robot.search("in:inbox",0,42)]=function(a){for(var c=a.data.searchResults.digests,b=0;b<c.length;b++){a=c[b];cachequeue.push(a)}setTimeout(cache_cycle,1E3)};runQueue()}}}
var cacheState={};(function(){try{if(window.localStorage&&localStorage.cacheState)for(var a=JSON.parse(localStorage.getItem("cacheState")),c=0;c<a.length;c++)cacheState[a[c]]=1}catch(b){}})();
function cache_cycle(){if(window.db){var a=null;if(a=cachequeue.shift()){callbacks[wave.robot.fetchWave(a.waveId,a.waveId.replace(/w\+.+/g,"conv+root"))]=function(c){db.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS inbox (waveid, result, data, date)");b.executeSql("DELETE FROM inbox WHERE waveid = ?",[a.waveId],function(e){e.executeSql("INSERT INTO inbox (waveid, result, data, date) VALUES (?, ?, ?, ?)",[a.waveId,JSON.stringify(a),JSON.stringify(c),new Date-0],function(){if(getEl(a.waveId))getEl(a.waveId).className=
"search fresh_cache";cacheState[a.waveId]=2;var g=[];for(var h in cacheState)g.push(h);localStorage.setItem("cacheState",JSON.stringify(g));setTimeout(cache_cycle,1E3)})})});return true};runQueue()}}}function resultClass(a){if(cacheState[a])if(cacheState[a]==1)return"old_cache";else{if(cacheState[a]==2)return"fresh_cache"}else return""}opt.appName="&mu;wave";opt.x.multipane="Enable multipane viewing experience (note, you must reload the page for changes to take effect)";opt.x.touchscroll="Add the TouchScroll library to do cool scrolly things on iPad Multipane (do not use on Desktop)";
opt.x.no_animate="Disable animated scrolling effect";opt.x.no_scrollhistory="Do not save search scroll position and restore to it";opt.x.old_results="Old results panel style";opt.x.largeFont="Use a larger font";opt.x.prefetch="Prefetch waves and load them, way faster and also not real time";opt.x.gadgets="Enable real wave gadget support (slow on mobile)";opt.x.render_state="If a gadget can not be internally rendered, display the gadget state";opt.x.bigspace="Add a large blank space under waves so the keyboard isn't messed up";
opt.x.no_sig="Do not automatically add <i>posted with micro-wave</i> signature";opt.x.use_protocol_21="Use old 0.21 version of wave protocol";opt.x.gsa="Show interface for changing gadget states (must have native gadgets enabled)";opt.x.owner_utils="Enable utilities for wave creators";opt.x.no_autoscroll="Disable smart autoscroll to latest blip";opt.x.swipe="Enable swiping gesture to navigate between blips (swipe left = prev, swipe right = next)";opt.x.keyboard="Enable keyboard shortcuts";
opt.gadgets===undefined&&screen_size>900&&opt.fn.set("gadgets",true);opt.bigspace===undefined&&mobilewebkit&&opt.fn.set("bigspace",true);opt.swipe===undefined&&mobilewebkit&&opt.fn.set("swipe",true);if(opt.multipane===undefined&&(screen_size>900||navigator.userAgent.indexOf("iPad")!=-1)){opt.fn.set("multipane",true);mobilewebkit&&opt.touchscroll===undefined&&opt.fn.set("touchscroll",true)}var endQueue=[];function onReady(a){endQueue.push(a)}
if(opt.multipane){getEl("search_parent").insertBefore(getEl("appheader"),getEl("search_parent").firstChild);document.body.className+=" multipane";getEl("header").innerHTML="&mu;wave";wave_container.innerHTML="<div style='padding:40px'>No waves loaded yet</div>";location.hash.indexOf("search:")==-1&&onReady(function(){autosearch("in:inbox");runQueue()})}opt.c.largeFont=function(a){document.body.style.fontSize=a==true?"16px":"13px"};var prefetched_waves={},unread_blips={};opt.c.largeFont(opt.largeFont);
function runTouchScroll(a){for(var c=0;c<a.length;c++){var b=a[c];console.log(b);if(typeof b=="string")b=getEl(b);window["touchscroll"+c]=new TouchScroll(b,{elastic:true})}}
function addTouchScroll(){var a=arguments;if(window.TouchScroll)return runTouchScroll(a);var c=document.createElement("link");c.href="js/lib/touchscroll.css";c.type="text/css";c.rel="stylesheet";document.body.appendChild(c);c=document.createElement("script");c.src="js/lib/touchscroll.min.js";c.onload=function(){setTimeout(function(){runTouchScroll(a)},100)};document.body.appendChild(c)}
function reset_touchscroll(){getEl("wave_container_parent").style.width=innerWidth-250+"px";getEl("wave_container").style.width=innerWidth-250+"px";getEl("search_parent").style.width="250px";getEl("search_parent_container").style.width="250px"}
if(opt.touchscroll&&opt.multipane){addTouchScroll("wave_container_parent","search_parent_container");getEl("wave_container_parent").style.overflow="hidden";getEl("search_parent").style.overflow="hidden";getEl("search_parent_container").style.overflow="hidden";getEl("wave_container").style.overflow="hidden";reset_touchscroll();window.onorientationchange=reset_touchscroll;window.addEventListener("resize",reset_touchscroll,true)}opt.keyboard===undefined&&opt.fn.set("keyboard",true);
if(opt.keyboard)document.body.onkeydown=function(a){if(a.target.tagName=="BODY")if(a.shiftKey&&a.keyCode==32||!a.shiftKey&&!a.ctrlKey&&a.keyCode==75){blip_prev(lastscrolled);a.preventDefault()}else if(a.keyCode==32||!a.shiftKey&&!a.ctrlKey&&a.keyCode==74){blip_next(lastscrolled);a.preventDefault()}};
opt.swipe&&function(){var a=0,c=0,b=0,e=0,g,h=0,j=function(n){if(n.touches.length==1){b=n.touches[0].pageX;e=n.touches[0].pageY;g=n.touches[0].target;h=+new Date}},m=function(n){if(n.touches.length==1){a=n.touches[0].pageX;c=n.touches[0].pageY}},k=function(){var n=+new Date-h,p=a-b,q=c-e,r=g;if(r){for(;!r.blipId&&r!=document.body;)r=r.parentNode;if(r.blipId)if(Math.abs(q)<30&&n<500)if(Math.abs(p)>60)p>0?blip_next(r.blipId):blip_prev(r.blipId)}};if(mobilewebkit){document.body.addEventListener("touchstart",
j,true);document.body.addEventListener("touchmove",m,true);document.body.addEventListener("touchend",k,true)}else{document.body.addEventListener("mousedown",function(n){j({touches:[n]})},true);document.body.addEventListener("mousemove",function(n){m({touches:[n]})},true);document.body.addEventListener("mouseup",function(n){k({touches:[n]})},true)}}();
function userList(a,c){var b=small_screen?2:5,e=document.createElement("span");if(a.length<=b||c){e.innerHTML=a.join(", ").replace(/antimatter15@googlewave.com/g,"<a href='http://antimatter15.com' target='_blank'>antimatter15</a>").replace(/@.*?(\,|$)/g,"$1");if(c){b=document.createElement("a");b.innerHTML=" (fewer)";b.href="javascript:void(0)";b.onclick=function(){e.parentNode.replaceChild(userList(a),e);return false};e.appendChild(b)}}else{e.innerHTML=a.slice(0,b).join(", ").replace(/antimatter15@googlewave.com/g,
"<a href='http://antimatter15.com'>antimatter15</a>").replace(/@.*?(\,|$)/g,"$1");var g=document.createElement("a");g.innerHTML=" ... ("+(a.length-b)+" more)";g.href="javascript:void(0)";g.onclick=function(){e.parentNode.replaceChild(userList(a,true),e);return false};e.appendChild(g)}return e}
function format_time(a){if(typeof a=="number"){var c=new Date;c.setTime(a);a=c}c=a.getHours();var b="am";if(c>12){c-=12;b="pm"}if(c==0)c=12;var e=a.getMinutes().toString();if(e.length==1)e="0"+e;return a.getMonth()+1+"/"+a.getDate()+" "+c+":"+e+b}function inline_blip_render(a){var c=document.createElement("div");c.className="thread";blip_render(a,c);return c}
document.body.onclick=function(a){a=a||window.event;var c=a.target||a.srcElement,b=c;if(c.tagName!="A"){for(;b&&!b.info&&!b.blipId&&b.tagName!="HEAD";)b=b.parentNode;if(b)if(b.info){a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();blip_next(b.blipId)}else if(b.blipId){a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();a=msg.data.blips[b.blipId].info;a.parentNode.insertBefore(create_contextmenu(msg.data.blips[b.blipId]),a.nextSibling)}}};function doNothing(){}
function blip_render(a,c){var b=msg.data.blips[a];if(!(!b||b.dom)){var e=renderBlip(b);msg.data.blips[a].dom=e;e.className="message";e.blipId=a;var g=document.createElement("div");g.className="info";g.info=true;g.blipId=a;b.info=g;var h="";h=chronological_blips[0]==a?chronological_blips.length==1?' <span class="blipend">X</span>':' <span class="blipend">&larr;</span>':chronological_blips[chronological_blips.length-1]==a?" <span class='blipstart'>&rarr;</span></div>":" <span class='nextarr'>&harr;</span></div>";
g.innerHTML="<div style='float:right;color:#555'>"+format_time(b.lastModifiedTime).toString()+h;g.appendChild(userList(b.contributors));e.onclick=doNothing;g.onclick=doNothing;e.insertBefore(g,e.firstChild);c.appendChild(e);a==chronological_blips[scrollto_position]&&setTimeout(function(){blip_scroll(scrollto_position)},500);return e}}
function create_wave(){window._gaq&&_gaq.push(["_trackEvent","Wave","Create wave"]);var a=loading("Creating wave...");setTimeout(function(){var c={};callbacks[wave.robot.createWavelet([],c)]=function(b){loading(a);setTimeout(function(){search_outdated=true;hashHandler("wave:"+b.data.waveId,true);runQueue()},100)};wave.wavelet.setTitle("New Wave",c.waveId,c.waveletId);runQueue()},500)}
function diff(a,c){for(var b=a.length,e=c.length,g=-1,h=-1;g++<b&&a[g]==c[g];);for(;h++<b&&a[b-h]==c[e-h];);return[g,b-h+1,c.substring(g,e-h+1)]}var current_blip=null,ctx_menu=null;
function create_magic_box(a,c){var b=document.createElement("div");b.style.marginRight="6px";b.innerHTML="<div class='alert'>"+a+"</div>";var e=document.createElement("textarea"),g=document.createElement("button"),h=document.createElement("button");g.innerHTML="Cancel";h.innerHTML="Submit";g.onclick=function(){b.style.display="none";current_blip=null;if(e.value.split(" ").length<42||confirm("Are you sure you want to cancel?")){b.style.display="none";current_blip=null}};var j=false;h.onclick=function(){e.disabled=
"disabled";h.disabled="disabled";if(!j){j=true;setTimeout(function(){c(e.value)},100)}};b.style.marginTop="10px";b.appendChild(e);b.appendChild(h);b.appendChild(g);b.textbox=e;return b}
function create_edit_box(){var a=create_magic_box("<b>Edit blip</b> (Beta)",function(b){var e=0;try{for(var g=current_blip.annotations.length,h=0;h<g&&current_blip.annotations[h].name!="conv/title";h++);if(h<g)e=current_blip.annotations[h].range.end}catch(j){}b=diff(current_blip.content.substr(e),"\n"+b);console.log(b);console.log(current_blip.content,"\n"+c.value);wave.blip.replace_range(b[2],e+b[0],e+b[1],current_blip.blipId,current_blip.waveId,current_blip.waveletId);loadWave(current_blip.waveId);
auto_reload=true;runQueue()}),c=a.textbox;c.style.height=Math.max(current_blip.dom.offsetHeight,100)+"px";c.className="edit_box";return a}
function create_reply_box(a){var c="";if(!a){c=" Note the current version of the wave data API does not support creating continuations of a thread, thus all responses will be indented. Hopefully, this will be fixed shortly.";a=true}c=create_magic_box("<b>Write a Reply</b>"+c,function(e){a?wave.blip.contentCreateChild(e,current_blip.blipId,current_blip.waveId,current_blip.waveletId):wave.blip.contentContinueThread(e,current_blip.blipId,current_blip.waveId,current_blip.waveletId);loadWave(current_blip.waveId);
auto_reload=true;runQueue()});var b="";if(navigator.userAgent.indexOf("Opera Mini")!=-1)b=" on Opera Mini";else if(mobilewebkit)b=navigator.userAgent.indexOf("Android")!=-1?" on Android":navigator.userAgent.indexOf("iPad")!=-1?" on iPad":navigator.userAgent.indexOf("iPod")!=-1?" on iPod":" on iPhone";if(!opt.no_sig)c.textbox.value="\n\nPosted with micro-wave.appspot.com"+b;c.textbox.className="reply_box";return c}
function create_contextmenu(a){function c(){b.style.display="none";b.parentNode.removeChild(b)}if(!onLine())return document.createElement("div");if(ctx_menu){ctx_menu.style.display="none";ctx_menu.parentNode&&ctx_menu.parentNode.removeChild(ctx_menu);delete ctx_menu}var b=document.createElement("div");current_blip=a;b.style.zIndex=32;var e={Reply:function(){window._gaq&&_gaq.push(["_trackEvent","Modify","Create Reply"]);try{var j=a.threadId?msg.data.threads[a.threadId].blipIds:msg.data.waveletData.rootThread.blipIds,
m=j.indexOf(a.blipId);if(j.length-1==m){var k=create_reply_box();k.className=""}else{k=create_reply_box(true);k.className="thread"}}catch(n){}current_blip.dom.parentNode.insertBefore(k,current_blip.dom.nextSibling);k.textbox.focus();c()},Indented:function(){window._gaq&&_gaq.push(["_trackEvent","Modify","Create Indented Reply"]);var j=create_reply_box(true);current_blip.dom.parentNode.insertBefore(j,current_blip.dom.nextSibling);j.className="thread";j.textbox.focus();c()},Delete:function(){if(confirm("Are you sure you want to delete the blip?")){window._gaq&&
_gaq.push(["_trackEvent","Modify","Delete existing blip"]);setTimeout(function(){wave.blip["delete"](current_blip.blipId,current_blip.waveId,current_blip.waveletId);loadWave(current_blip.waveId);auto_reload=true;runQueue();c()},100)}c()},Edit:function(){window._gaq&&_gaq.push(["_trackEvent","Modify","Edit existing blip"]);var j=create_edit_box();current_blip.dom.parentNode.insertBefore(j,current_blip.dom.nextSibling);var m=0;try{for(var k=current_blip.annotations.length,n=0;n<k&&current_blip.annotations[n].name!=
"conv/title";n++);if(n<k)m=current_blip.annotations[n].range.end}catch(p){}j.textbox.value=current_blip.content.substr(m+1);j.textbox.focus();c()}};if(a.blipId==msg.data.waveletData.rootBlipId)e.Title=function(){var j=prompt("Enter new wavelet title",msg.data.waveletData.title);window._gaq&&_gaq.push(["_trackEvent","Modify","Change Wavelet Title"]);if(j){wave.wavelet.setTitle(j,a.waveId,a.waveletId);loadWave(a.waveId,a.waveletId);auto_reload=true;runQueue()}};for(var g in e){var h=document.createElement("a");
h.href="javascript:void(0)";h.onclick=e[g];h.innerHTML=g;b.appendChild(h);b.appendChild(document.createTextNode(" / "))}h=document.createElement("a");h.href="javascript:void(0);";h.style.color="red";h.innerHTML="Close";h.onclick=function(){c()};b.appendChild(h);b.className="contextmenu";return ctx_menu=b}function registerRpc(a,c){gadgets.rpc.register(a,function(){c(this.s,this.f,this.a)})}
function init_gadget_handler(a){if(window.gadgets)a();else{Math.random().toString(36).substr(4);var c=document.createElement("script");c.src="https://wave.google.com/gadgets/js/core:rpc?debug=1&c=1";(function(){if(window.gadgets){initGadgetSystem();a()}else setTimeout(arguments.callee,100)})();document.body.appendChild(c)}}
function extractGadgetState(a){console.log(a);var c=gstates[a].participants,b=gstates[a].state;gadgets.rpc.call(a,"wave_gadget_mode",null,{"${playback}":"0","${edit}":"1"});gadgets.rpc.call(a,"wave_participants",null,c);gadgets.rpc.call(a,"wave_gadget_state",null,b);gadgets.rpc.call(a,"wave_private_gadget_state",null,{})}
function initGadgetSystem(){registerRpc("wave_enable",function(a,c){gadgets.rpc.setRelayUrl(c,"http://www.gmodules.com/gadgets/files/container/rpc_relay.html");extractGadgetState(c)});registerRpc("resize_iframe",function(a,c,b){getEl(c).height=b[0]});gadgets.rpc.registerDefault(function(){var a=this.s,c=this.a[0],b=this.f;console.log(this);if(a=="wave_gadget_state"){console.log("updating state");for(var e in c)gstates[b].state[e]=c[e];wave.blip.update_element(c,gstates[b].blipId,current_wave,current_wavelet);
runQueue();gadgets.rpc.call(b,"wave_gadget_state",null,gstates[b].state)}console.log(a,c)})}function create_gadget_frame(a,c,b){var e=document.createElement("div");e.innerHTML='<iframe name="'+a+'" >';e=e.firstChild;e.id=a;e.width="320px";e.height="250px";e.frameBorder="yes";e.scrolling="no";e.marginHeight=0;e.marginWidth=0;b=b||document.body;b.appendChild(e);e.src=c;return e}
function load_native_gadget(a,c,b,e){var g="gadget_frame"+Math.random().toString(36).substr(4);console.log(c);for(var h={myId:username,authorId:c.properties.author,participants:{}},j=msg.data.waveletData.participants,m=j.length;m--;)h.participants[j[m]]={id:j[m],displayName:j[m].replace(/@.*$/,""),thumbnailUrl:"https://wave.google.com/a/google.com/static/images/unknown.jpg"};gstates[g]={state:a,participants:h,blipId:b.blipId};var k=opt.gsa?"http://anti15.chemicalservers.com/debugwave.xml":opt.gsa1?
"http://anti15.chemicalservers.com/state.xml":c.properties.url,n="http://www.gmodules.com/gadgets/ifr?container=wave&view=default&debug=0&lang=en&country=ALL&nocache=0&wave=1&mid="+encodeURIComponent(g)+"&parent="+encodeURIComponent(location.protocol+"//"+location.host+location.pathname)+"&url="+encodeURIComponent(k);init_gadget_handler(function(){create_gadget_frame(g,n,e);console.log("creating "+g+" for gadget "+k)})}function native_gadget(){}
function renderGadget(a,c){var b={},e=[];for(var g in a.properties){if(g!="url"&&g!="author")b[g]=a.properties[g];e.push(g)}var h=document.createElement("div");h.style.margin="10px";var j=a.properties.url;h.innerHTML="<b>gadget</b> "+j+" <br>";if(window.opt.gadgets){load_native_gadget(b,a,c,h);return h}if(j=="http://wave-api.appspot.com/public/gadgets/areyouin/gadget.xml"){var m={y:[],n:[],m:[]};for(g in b)/:answer$/.test(g)&&m[b[g]].push(g.substr(0,g.length-7));for(var k in m){h.innerHTML+="<br><span style='color:red;font-weight:bold'>"+
{m:"Maybe",y:"Yes",n:"No"}[k]+"</span><br> ";if(m[k].length==0)h.innerHTML+="(None) <br>";for(g=0;g<m[k].length;g++)h.innerHTML+=m[k][g].replace(/@googlewave.com/g,"")+' <span style="color: gray;font-style: italic">'+(b[m[k][g]+":status"]||"")+"</span><br>"}}else if(j=="http://plus-one.appspot.com/plus-one.xml"){m=0;for(g in b)m+=parseInt(b[g]);h.innerHTML+="<br><b>Votes:</b> "+m+"/"+e.length}else if(j=="http://www.elizabethsgadgets.appspot.com/public/gadget.xml")h.innerHTML+="<br> <b>Pluses</b> ("+
(b.pluses||0)+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Minuses</b> ("+(b.minuses||0)+")";else if(j=="http://pushyrobot.appspot.com/gadgets/github.xml")h.innerHTML+="<pre>"+JSON.stringify(JSON.parse(unescape(b.commit)),null,2)+"</pre>";else if(j=="http://everybodywave.appspot.com/gadget/image/gadget.xml")h.innerHTML+='<img src="'+b.imgUrl+'" width="'+b.imgWidth+'" height="'+b.imgHeight+'">';else if(j=="http://wavepollo.appspot.com/wavepollo/com.appspot.wavepollo.client.PolloWaveGadget.gadget.xml"){k={};for(m in b)if(m.indexOf("MVOTE_")==
0)if(g=m.match(/MVOTE_(.+)(OPT_.+)$/)){k[g[2]]||(k[g[2]]=[]);k[g[2]].push(g[1])}for(m in k){h.innerHTML+="<br><span style='color:red;font-weight:bold'>"+b[m]+"</span> ("+k[m].length+")<br> ";for(g=0;g<k[m].length;g++)h.innerHTML+=k[m][g].replace(/@googlewave.com/g,"")+", "}}else if(j=="https://statusee.appspot.com/gadget/statusee.xml")h.innerHTML+="<b>Status</b> "+({notstarted:"Not started",describing:"Describing",brainstorming:"Brainstorming",inprogress:"In Progress",inreview:"In Review",pending:"Pending",
testing:"Testing",completed:"Completed",rejected:"Rejected",canceled:"Canceled"}[b.sel]||b.sel.substr(7));else if(j=="http://wave-poll.googlecode.com/svn/trunk/src/poll.xml")for(m in b){k=JSON.parse(b[m]).participants;h.innerHTML+="<br><span style='color:red;font-weight:bold'>"+m.substr(7)+"</span> ("+k.length+")<br> ";for(g=0;g<k.length;g++)h.innerHTML+=k[g].replace(/@googlewave.com/g,"")+", "}else if(j=="https://everybodywave.appspot.com/gadget/miniroster/main.xml"){h.innerHTML+="<br><span style='color:red;font-weight:bold'>Assigned</span> ("+
e.length+")<br> ";for(m in b)h.innerHTML+=m.split("~")[3]+", "}else if(j=="http://www.nebweb.com.au/wave/likey.xml")h.innerHTML+="<br> <b>Like</b> ("+(b.likeCount||0)+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Dislike</b> ("+(b.dislikeCount||0)+")";else if(window.opt.render_state||JSON.stringify(b).length<1337){console.log("Unknown Gadget",j);a=document.createTextNode(JSON.stringify(b,null,2));b=document.createElement("div");b.appendChild(a);h.innerHTML+='<div class="monospace">'+b.innerHTML+"</div>"}return h}
function loading(a,c){var b=getEl("loading"),e=typeof document.createElement("div").style.opacity!="undefined";b.style.top=scrollY+"px";if(typeof a=="number"){if(e)b.style.opacity="0";else b.style.display="none";delete loadIds[a];setTimeout(function(){b.style.display="none"},500)}else{var g=Math.random()*42;loadIds[g]=true;setTimeout(function(){b.style.top=scrollY+"px";if(loadIds[g]){b.style.display="";if(e)b.style.opacity="1";getEl("loadingtext").innerHTML="<b>Loading</b> "+a}},c?0:0);return g}}
function error(a){var c=getEl("error");c.style.display="";getEl("errortext").innerHTML=a;c.onclick=function(){c.style.display="none"}}var lastscrolled="",gstates={};
function blip_scroll(a){if(a<0)a=chronological_blips.length+a;try{msg.data.blips[lastscrolled].info.className="info"}catch(c){}lastscrolled=chronological_blips[a];if(msg.data.blips[chronological_blips[a]].dom){msg.data.blips[lastscrolled].info.className="info selected";scroll_wavepanel(msg.data.blips[chronological_blips[a]].dom.offsetTop);return true}return false}
function blip_index(a){return[].indexOf?chronological_blips.indexOf(a):function(c,b,e){for(e=b.length;e--&&b[e]!=c;);return e}(a,chronological_blips)}function blip_next(a){try{for(var c=blip_index(a);c&&blip_scroll(--c)==false;);}catch(b){}}function blip_prev(a){try{var c=blip_index(a),b=chronological_blips.length-1;if(!(c<0))for(;c<b&&blip_scroll(++c)==false;);}catch(e){}}
function animated_scroll(a,c){var b=a==window,e=b?pageYOffset:a.scrollTop;if(e!=c){var g=Math.min(1E3,2*Math.sqrt(42*Math.abs(c-e))),h,j=+new Date+g;(h=function(){var m=Math.min(1,1-(j-new Date)/g),k=(c-e)*(-Math.cos(m*Math.PI)/2+0.5)+e;if(b)scrollTo(0,k);else a.scrollTop=k;m<1&&setTimeout(h,0)})()}}
function scroll_wavepanel(a){var c=getEl("wave_container_parent");a=a<0?c.scrollHeight+1+a:a;if(opt.multipane)if(opt.touchscroll)touchscroll0.scrollTo(0,a);else if(opt.no_animate)c.scrollTop=a;else animated_scroll(c,a);else{a=a<0?innerHeight+1+a:a;opt.no_animate?scrollTo(0,a):animated_scroll(window,a)}}
function scroll_searchpanel(a){var c=getEl("search_parent_container");a=a<0?c.scrollHeight+1+a:a;if(opt.multipane)if(opt.touchscroll)touchscroll1.scrollTo(0,a);else if(opt.no_animate)c.scrollTop=a;else animated_scroll(c,a);else{a=a<0?innerHeight+1+a:a;opt.no_animate?scrollTo(0,a):animated_scroll(window,a)}}function hide_float(){getEl("floating_menu").className=""}
function markWaveRead(){var a=loading("mark as read");window._gaq&&_gaq.push(["_trackEvent","Mark","Mark wave read"]);callbacks[wave.robot.folderAction("markAsRead",current_wave,current_wavelet)]=function(){loading(a)};hide_float();search_outdated=true;runQueue()}
function archiveWave(){var a=loading("archive wave");window._gaq&&_gaq.push(["_trackEvent","Mark","Mark wave archived"]);callbacks[wave.robot.folderAction("archive",current_wave,current_wavelet)]=function(){loading(a)};hide_float();runQueue()}
function update_scroll(){if(current_page==0)searchscroll=scrollY;getEl("loading").style.top=scrollY+"px";var a=scrollY+window.innerHeight-64;if(mobilewebkit)getEl("floating_menu").style["-webkit-transform"]="translateY("+a+"px)";else getEl("floating_menu").style.top=a+"px"}window.onresize=document.onscroll=window.onscroll=update_scroll;mobilewebkit&&setInterval(document.onscroll,500);
function flicker(a){getEl("floating_menu").style.backgroundColor="#D1FCC9";a.style.color="green";a.style.fontWeight="bold";setTimeout(function(){a.style.color="";a.style.fontWeight="";getEl("floating_menu").style.backgroundColor=""},500)}username="wheisenberg@googlewave.com";function getUsername(){callbacks[wave.robot.fetchWave("googlewave.com!w+bWEBb5mBA","googlewave.com!conv+poop")]=function(a){username=a.error.message.match(/internalError: (.+@.+) is not a participant/)[1];return true}}
function clean_text(a){return a.replace(/[\0-\x09\x0b-\x1f\x7f\x80-\x9f\u2028\u2029\ufff9\ufffa\ufffb\u200e\u200f\u202a-\u202e]/g,"")}
wave={robot:{fetchWave:function(a,c){return queueOp("wave.robot.fetchWave",{waveId:a,waveletId:c})},search:function(a,c,b){return queueOp("wave.robot.search",{query:a,index:c,numResults:b})},folderAction:function(a,c,b){return queueOp("wave.robot.folderAction",{waveId:c,modifyHow:a,waveletId:b})},notifyCapabilitiesHash:function(a){var c=(opt.use_protocol_21?0.21:0.22).toString();return queueOp("wave.robot.notifyCapabilitiesHash",{protocolVersion:a||c})},createWavelet:function(a,c){var b="TBD_"+g+
"_0x"+(Math.random()*9E5).toString(16),e=username.replace(/^.+@/,""),g=e+"!conv+root";e=e+"!TBD_0x"+(Math.random()*9E5).toString(16);c||(c={});c.waveId=e;c.waveletId=g;c.rootBlipId=b;return queueOp("wave.robot.createWavelet",{waveletId:g,waveletData:{waveletId:g,waveId:e,rootBlipId:b,participants:a},waveId:e})}},wavelet:{appendBlip:function(a,c,b,e){var g="TBD_"+username.replace(/^.+@/,"")+"!conv+root_0x"+(Math.random()*9E5).toString(16);return queueOp("wave.wavelet.appendBlip",{waveletId:e,waveId:b,
blipId:g,blipData:{waveletId:e,blipId:g,waveId:b,content:a,parentBlipId:c},parentBlipId:c})},modifyParticipantRole:function(a,c,b,e){return queueOp("wave.wavelet.modifyParticipantRole",{waveletId:e,waveId:b,participantId:a,participantRole:c})},removeTag:function(a,c,b){return queueOp("wave.wavelet.modifyTag",{waveletId:b,waveId:c,name:a,modifyHow:"remove"})},addTag:function(a,c,b){return queueOp("wave.wavelet.modifyTag",{waveletId:b,waveId:c,name:a})},setTitle:function(a,c,b){return queueOp("wave.wavelet.setTitle",
{waveletId:b,waveId:c,waveletTitle:a})},participant:{add:function(a,c,b){return queueOp("wave.wavelet.participant.add",{waveId:c,waveletId:b,participantId:a})}}},document:{appendMarkup:function(a,c,b,e){return queueOp("wave.document.appendMarkup",{waveletId:e,waveId:b,blipId:c,content:a})},modify:function(a,c,b,e){return queueOp("wave.document.modify",{waveletId:e,waveId:b,blipId:c,modifyAction:a})},modify_range:function(a,c,b,e,g,h){return queueOp("wave.document.modify",{waveletId:h,waveId:g,blipId:e,
modifyAction:a,range:{start:c,end:b}})}},blip:{"delete":function(a,c,b){return queueOp("wave.blip.delete",{waveletId:b,waveId:c,blipId:a})},replace:function(a,c,b,e){a=clean_text(a);return wave.document.modify({modifyHow:"REPLACE",values:["\n"+a]},c,b,e)},replace_range:function(a,c,b,e,g,h){a=clean_text(a);return wave.document.modify_range({modifyHow:"REPLACE",values:[a]},c,b,e,g,h)},update_element:function(a,c,b,e){return queueOp("wave.document.modify",{waveletId:e,waveId:b,blipId:c,modifyAction:{modifyHow:"UPDATE_ELEMENT",
elements:[{type:"GADGET",properties:a}]},modifyQuery:{restrictions:{},maxRes:1,elementMatch:"GADGET"}})},upload_attachment:function(a,c,b,e,g){return queueOp("wave.document.modify",{blipId:b,waveletId:g,waveId:e,modifyAction:{modifyHow:"INSERT_AFTER",elements:[{type:"ATTACHMENT",properties:{caption:c,data:a+"\n"}}]}})},insert:function(a,c,b,e){a=clean_text(a);return wave.document.modify({modifyHow:"INSERT",values:["\n"+a]},c,b,e)},append:function(a,c,b,e){a=clean_text(a);return wave.document.modify({modifyHow:"INSERT_AFTER",
values:[a]},c,b,e)},createChild:function(a,c,b,e){return queueOp("wave.blip.createChild",{waveletId:b,waveId:c,blipId:a,blipData:{waveletId:b,blipId:e,waveId:c,content:"",parentBlipId:a}})},continueThread:function(a,c,b,e){return queueOp("wave.blip.continueThread",{waveletId:b,waveId:c,blipId:a,blipData:{waveletId:b,blipId:e,waveId:c,content:"",parentBlipId:a}})},contentCreateChild:function(a,c,b,e){var g="TBD_"+e+"_0x"+(Math.random()*9E5).toString(16);wave.blip.createChild(c,b,e,g);wave.blip.replace(a,
g,b,e)},contentContinueThread:function(a,c,b,e){var g="TBD_"+e+"_0x"+(Math.random()*9E5).toString(16);wave.blip.continueThread(c,b,e,g);wave.blip.replace(a,g,b,e)}}};
function chronological_blip_render(a){var c=[];for(var b in msg.data.blips)c.push(msg.data.blips[b]);c=c.sort(function(g,h){return g.lastModifiedTime-h.lastModifiedTime});var e=c.length-1;(function(){for(var g=Math.max(0,e-10);e>=g;e--){var h=e,j=blip_render(c[h].blipId,a);if(msg.data.blips[c[h].parentBlipId]&&j){var m=document.createElement("blockquote");h=msg.data.blips[c[h].parentBlipId];var k=h.contributors.join(", ").replace(/@googlewave.com/g,"")+":"+h.content;m.innerHTML=k.substr(0,140)+(k.length>
140?"...":"");m.setAttribute("onclick","msg.data.blips['"+h.blipId+"'].dom.scrollIntoView()");j.insertBefore(m,j.getElementsByTagName("div")[0].nextSibling)}}g&&setTimeout(arguments.callee,0)})()}
function recursive_blip_render(a,c){var b=blip_render(a,c),e=msg.data.blips[a];if(e.childBlipIds.length>0){if(e.childBlipIds.length>1){var g=document.createElement("div");g.className="thread";for(var h=1;h<e.childBlipIds.length;h++)recursive_blip_render(e.childBlipIds[h],g);g.childNodes.length!=0&&c.appendChild(g)}recursive_blip_render(e.childBlipIds[0],c)}return b}
function bootstrap_thread_render(a){var c=msg.data.waveletData.rootThread.blipIds,b=c.length,e=0;(function(){for(var g=e+5;e<g&&e<b;)thread_render(c[e++],a);e<b&&setTimeout(arguments.callee,0)})()}
function thread_render(a,c){var b=msg.data.blips[a];if(b)if(!b.dom){var e=blip_render(a,c);b=b.replyThreadIds;var g=b.length;if(g!=0){var h=document.createElement("div");h.className="thread";c.appendChild(h);for(var j=0;j<g;j++)for(var m=msg.data.threads[b[j]].blipIds,k=m.length,n=0;n<k;n++)thread_render(m[n],h)}return e}}
function renderImage(a,c){var b=document.createElement("img");b.style.display="none";b.src=a;(function(e){e.onload=function(){var g=screen_size;try{g=parseInt(getComputedStyle(document.documentElement,c).width)}catch(h){g=screen_size}if(e.width>g-21){e.style.width="100%";e.onclick=function(){e.style.width=e.style.width.indexOf("%")==-1?"100%":""}}e.style.display=""}})(b);c.appendChild(b)}
function renderBlip(a){for(var c=a.content+" ",b={},e={},g={},h=0;h<a.annotations.length;h++){var j=a.annotations[h];if(j.name.indexOf("user/d/")==0){var m=j.value.split(","),k=j.name.substr(7);if(new Date-parseInt(m[1])<6E4)g[k]="rgb("+Math.floor(205-Math.random()*100).toString()+","+Math.floor(205-Math.random()*100).toString()+","+Math.floor(205-Math.random()*100).toString()+")"}if(b[j.range.start])b[j.range.start].push(h);else b[j.range.start]=[h];if(e[j.range.end])e[j.range.end].push(h);else e[j.range.end]=
[h]}m={};var n=document.createElement("div"),p=null,q=null,r="";for(h=0;h<c.length;h++){if(b[h]||e[h]||a.elements[h]){r&&q.appendChild(document.createTextNode(r));r="";if(a.elements[h]){k=a.elements[h];if(k.type=="INLINE_BLIP")n.appendChild(inline_blip_render(k.properties.id));else if(k.type=="IMAGE"){p=document.createElement("div");p.innerHTML="<b>"+(k.properties.attachmentId||"")+"</b> "+(k.properties.caption||"")+"<br>";k.properties.url&&renderImage(k.properties.url,p);n.appendChild(p)}else if(k.type==
"INSTALLER"){p=document.createElement("div");p.style.border="3px dotted orange";p.style.margin="10px";p.innerHTML="&lt;<b>Extension Installer</b> "+k.properties.manifest+"&gt;";n.appendChild(p)}else if(k.type=="ATTACHMENT"){p=document.createElement("div");p.style.margin="10px";p.innerHTML="<b>"+k.properties.mimeType+"</b> "+k.properties.caption+"<br>";if(k.properties.mimeType.indexOf("image/")==0)renderImage(k.properties.attachmentUrl,p);else p.innerHTML+="<a href='"+k.properties.attachmentUrl+"'>Download</a>";
n.appendChild(p)}else if(k.type=="GADGET")n.appendChild(renderGadget(k,a));else k.type!="LINE"&&console.log("unknown element type",k.type,k.properties);p=document.createElement(k.properties.lineType||"p");if(k.properties.indent)p.style.marginLeft=k.properties.indent*20+"px";if(k.properties.alignment)p.style.textAlign={l:"left",c:"center",r:"right"}[k.properties.alignment];k.properties.direction&&p.setAttribute("dir",{l:"ltr",r:"rtl"}[k.properties.alignment]);n.appendChild(p)}if(b[h])for(var d=b[h],
f=d.length;f--;){j=a.annotations[d[f]];m[j.name]||(m[j.name]=[]);m[j.name].push(j.value);if(j.name.indexOf("user/e/")==0){k=j.name.substr(7);if(g[k]){var i=document.createElement("span");i.className="cursor";i.innerHTML=j.value.replace(/@.+/,"");i.style.backgroundColor=g[k];q.appendChild(i)}}}if(e[h]){d=e[h];for(f=d.length;f--;){j=a.annotations[d[f]];m[j.name].shift();m[j.name].length==0&&delete m[j.name]}}q=m["link/auto"]||m["link/manual"]||m["link/wave"]?document.createElement("a"):document.createElement("span");
p.appendChild(q);for(j in m){k=m[j][0];if(j.indexOf("style/")==0)q.style[j.substr(6)]=k;else if(j=="conv/title")q.style.fontWeight="bold";else if(j!="spell")if(j!="lang")if(j=="link/manual"||j=="link/auto")if(/^waveid:\/\//.test(k)){q.href="#wave:"+k.substr(9);q.setAttribute("onclick","ch(this)")}else if(/wave:(.+?)(\,$)/.test(k)){q.href="#wave:"+k.match(/wave:(.+?)(\,$)/)[1];q.setAttribute("onclick","ch(this)")}else{q.href=k;q.target="_blank"}else if(j=="link/wave"){q.href="#wave:"+k;q.setAttribute("onclick",
"ch(this)")}else j.indexOf("user/e")!=0&&j.indexOf("user/d")!=0&&j.indexOf("user/r")!=0&&console.log("unrecognized annotation",j,k)}}if(c.charAt(h)!="\n")r+=c.charAt(h)}r&&q.appendChild(document.createTextNode(r));return n}var queue=[],callbacks={},id_count=0;
window.logoff||(logoff=function(){if(confirm("Are you sure you want to log off?")){var a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET","/logout",true);a.onreadystatechange=function(){a.readyState==4&&logoff_ui()};a.send(null)}});function logoff_ui(){getEl("login").style.display="";getEl("appheader").style.display="none";getEl("content").style.display="none"}
function logon_ui(){getEl("login").style.display="none";getEl("appheader").style.display="";getEl("content").style.display=""}function queueOp(a,c,b){var e=(id_count++).toString();if(b)callbacks[e]=b;queue.push({id:e,method:a,params:c});return e}if(!window.doXHR)window.doXHR=function(a,c){var b=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");b.open("POST","/rpc",true);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){b.readyState==4&&c(b)};b.send(a)};
function runQueue(){if(queue.length==0)return false;for(var a=[],c=0;c<queue.length;c++)a.push(queue[c].id);doXHR(JSON.stringify(queue),function(b){if(b.status==200){var e;try{e=JSON.parse(b.responseText)}catch(g){if(b.responseText.indexOf("Error 401")!=-1)return logoff_ui();for(var h=0;h<a.length;h++){var j=null,m=a[h];if(callbacks[m]){try{j=callbacks[m]()}catch(k){}delete callbacks[m]}if(!j){console.log("Server Error: Could not parse as JSON",b.responseText);error("JSON not parseable.")}}}if(e){console.log(e);
for(h=0;h<e.length;h++){m=e[h].id;j=null;if(callbacks[m]){j=callbacks[m](e[h]);delete callbacks[m]}if(e[h].error&&!j){if(e[h].error.code==401)return logoff_ui();console.log("Error "+e[h].error.code+": "+e[h].error.message);error(e[h].error.message)}}}}else for(h=0;h<a.length;h++){j=null;m=a[h];if(callbacks[m]){try{j=callbacks[m]()}catch(n){}delete callbacks[m]}if(!j){console.log("Server Error: Error not caught.",b.status);error("No data was returned in the server response.")}}});queue=[]}
function autosearchbox(){var a=document.forms.searchbox.query.value;a.toLowerCase().indexOf("wave:")==0||a.toLowerCase().indexOf("new:")==0?hashHandler("#"+a,true):hashHandler("#search:"+a,true)}
function autosearch(a){if(a==current_search&&current_page==1&&search_outdated==false&&!opt.multipane){getEl("suggest").style.display="";searchmode(0);current_page=0;search_container.style.display="";!opt.no_scrollhistory&&!opt.multipane&&scroll_searchpanel(searchscroll);if(!opt.multipane){wave_container.style.display="none";opt.multipane||(msg={});wave_container.innerHTML=""}}else{current_search=document.forms.searchbox.query.value=a;update_search()}if(!opt.multipane)getEl("floating_menu").style.display=
"none"}function searchmode(){}function set_user_mode(a){username.replace(/^.+@/,"");msg.data.waveletData.participants.slice(1).forEach(function(c){wave.wavelet.modifyParticipantRole(c,a||"READ_ONLY",current_wave,msg.data.waveletData.waveletId);alert("done setting "+(msg.data.waveletData.participants.length-1)+" people as "+(a||"READ_ONLY"))});runQueue()}
function add_tag(){var a=prompt("Add tag");if(a){wave.wavelet.addTag(a,msg.data.waveletData.waveId,msg.data.waveletData.waveletId);loadWave(msg.data.waveletData.waveId);auto_reload=true;runQueue()}}
function update_search(){current_page=0;var a=loading(current_search);opt.multipane||(msg={});extend_search(0,function(){loading(a);getEl("suggest").style.display="";search_container.innerHTML="";searchmode(0);search_container.style.display="";if(!opt.multipane){wave_container.style.display="none";wave_container.innerHTML=""}})}function auto_extend(a){a.innerHTML="Loading...";extend_search(searchLastIndex+42,function(){a.parentNode.removeChild(a)});runQueue()}
if(!window.resultClass)window.resultClass=function(){return""};
function extend_search(a,c){searchLastIndex=a;search_outdated=false;window._gaq&&_gaq.push(["_trackEvent","Search","Load Search Page",current_search]);var b=function(e){c&&c();console.log(e);var g="",h=e.data.searchResults.digests;if(opt.prefetch&&onLine()==true){var j=0;setTimeout(function(){var q=h[j++];if(q){var r=q.waveId.replace(/[\/!].+/,"!conv+root");callbacks[wave.robot.fetchWave(q.waveId,r)]=function(d){if(d)prefetched_waves[q.waveId]=d;return true};runQueue();setTimeout(arguments.callee,
500)}},1E3)}for(var m=0;m<h.length;m++){e=h[m];e.title=e.title.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");e.snippet=e.snippet.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");unread_blips[e.waveId]=e.unreadCount;if(opt.old_results)g+='<a href="#wave:'+e.waveId+'" class="searchlink" onclick=\'ch(this)\'><div class="search"><b>'+e.title+"</b> <span style='color:gray'>"+e.snippet+"</div></a>";else{var k=e.unreadCount>0?"<span class='unread_msg'><span class='bubble'>"+e.unreadCount+"</span> of "+e.blipCount+
"</span>":"<span class='read_msg'>"+e.blipCount+" msgs</span>",n=format_time(e.lastModified),p=opt.offline?' <span class="cachestate">cache</span>':"";k='<div id="'+e.waveId+'" class="search '+resultClass(e.waveId)+'"><div class="date">'+n+"<br>"+k+p+'</div><span class="title_'+(e.unreadCount>0?"unread":"read")+'">'+e.title+"</span> <span class='snippet'>"+e.snippet+"</span> </div>";g+='<a href="#wave:'+e.waveId+'" class="searchlink" onclick=\'ch(this)\'>'+k+"</a>"}}search_container.innerHTML+=g;
search_container.innerHTML+=onLine()==false?'<div class="footer"><b>Sorry!</b> No further waves have been cached.</div>':h.length<42?h.length==0?current_search.indexOf("is:unread")!=-1?"<div class='footer'><b>Yay</b>, no unread items!</div>":"<div class='footer'>Your search query has <b>zero results</b>. Try broaden your search?</div>":"<div class='footer'><b>Hooray!</b> You've reached the end of the universe!</div>":'<div class="footer" onclick="auto_extend(this);"><b>Extend</b> Search (Page '+(a/
42+1)+")</div>"};if(onLine()==true)callbacks[wave.robot.search(current_search,a||0,42)]=b;else{open_db();if(!window.db)return console.log("no database");db.transaction(function(e){e.executeSql("SELECT * FROM inbox",[],function(g,h){for(var j=[],m=0;m<h.rows.length;m++)j.push(JSON.parse(h.rows.item(m).result));b({data:{searchResults:{digests:j}}})})})}}function ch(a){hashHandler(a.href.substr(a.href.indexOf("#")),true)}
function hashHandler(a,c){var b=lasthash;lasthash=a;if(a.charAt(0)=="#")a=unescape(a.substr(1));if(!(unescape("#"+a)==unescape(b)&&!c)){if(unescape(unescape(unescape(location.hash)))!="#"+unescape(unescape(unescape(a))))location.hash="#"+unescape(unescape(a));if(a.indexOf("search:")==0){autosearch(a.substr(7));runQueue()}else if(a.indexOf("wave:")==0){loadWave(a.substr(5));runQueue()}else a.toLowerCase().indexOf("new:wave")==0&&create_wave()}}
typeof window.onhashchange=="undefined"&&setInterval(function(){window.onhashchange()},100);window.onhashchange=function(){hashHandler(location.hash)};var chronological_blips=[];
function loadWave(a,c){var b=loading(a),e=null,g;if(g=a.match(/(\w+\.\w+)\/(w\+\w+)\/\~\/(\w+\+\w+)\/(b\+\w+)/)){a=g[1]+"!"+g[2];c=g[1]+"!"+g[3];e=g[4]}else{a=a.replace("/","!");c=c||a.replace(/[\/!].+/,"!conv+root")}var h=function(j){try{window._gaq&&_gaq.push(["_trackEvent","Wave","Load Wave",j.data.waveletData.title])}catch(m){}loading(b);console.log(j);if(j.error)if(j.error.message.indexOf("not a participant")!=-1){alert("You are not a participant of the wave/wavelet. \nThis may be due to a bug in the current version of the data api which does not allow access to waves unless you are explicitly a participant. don't blame me");
return true}else return false;if(j.data.waveletData){window.msg=j;searchmode(1);if(!opt.multipane)search_container.style.display="none";current_page=1;wave_container.style.display="";update_scroll();getEl("floating_menu").style.display="";if(!opt.no_autoscroll){if(Object.keys)var k=Object.keys(msg.data.blips);else{k=[];for(var n in msg.data.blips)k.push(n)}chronological_blips=k.sort(function(q,r){return msg.data.blips[r].lastModifiedTime-msg.data.blips[q].lastModifiedTime})}scrollto_position=-1;if(!auto_reload)if(!opt.no_scrollhistory){scrollTo(0,
0);if(!opt.no_autoscroll)if(unread_blips[a])scrollto_position=unread_blips[a]-1;if(e)try{scrollto_position=chronological_blips.indexOf(e)}catch(p){}}auto_reload=false;if(!opt.multipane)getEl("suggest").style.display="none";wave_container.innerHTML="";if(opt.owner_utils&&msg.data.waveletData.participants[0]==username)wave_container.innerHTML+='<div><button onclick="set_user_mode()">Everyone Read Only</button><button onclick="set_user_mode(\'FULL\')">Everyone Full Access</button></div>';k=document.createElement("div");
k.className="wavelet";n=document.createElement("a");n.innerHTML=" Add";n.className="addparticipant";n.href="javascript:void(0)";n.onclick=function(){var q=prompt("Enter Participant ID to Add");window._gaq&&_gaq.push(["_trackEvent","Modify","Add participant"]);if(q){if(q.indexOf("@")==-1)q+="@googlewave.com";wave.wavelet.participant.add(q,a,c);loadWave(a);auto_reload=true;runQueue()}};k.appendChild(n);k.appendChild(userList(j.data.waveletData.participants));wave_container.appendChild(k);current_wave=
a=a.replace(/\s/,"");current_wavelet=c;k=document.createElement("div");wave_container.appendChild(k);if(getEl("chronos").checked)chronological_blip_render(k);else msg.data.waveletData.rootThread?bootstrap_thread_render(k):recursive_blip_render(msg.data.waveletData.rootBlipId,k);k=document.createElement("div");j=j.data.waveletData.tags.join(", ");if(j.length==0)j="(No Tags)";k.innerHTML="<b>Tags:</b> ";k.innerHTML=' <a href="javascript:add_tag()" style="float:right">Add</a>';k.appendChild(document.createTextNode(j));
k.className="tags";wave_container.appendChild(k);j=document.createElement("div");j.innerHTML='<a href="https://wave.google.com/wave/#restored:wave:'+escape(escape(a))+'" target="_blank">Open this wave in the official wave client</a>';j.className="footer";wave_container.appendChild(j);if(opt.bigspace){j=document.createElement("div");j.style.height="250px";wave_container.appendChild(j)}}else alert("The server sent nothing")};if(onLine()==false){open_db();if(!window.db)return console.log("no database");
db.transaction(function(j){j.executeSql("SELECT * FROM inbox WHERE waveid = ?",[a],function(m,k){var n=JSON.parse(k.rows.item(0).data);h(n)})})}else if(opt.prefetch&&prefetched_waves[a])h(JSON.parse(JSON.stringify(prefetched_waves[a])));else callbacks[wave.robot.fetchWave(a,c)]=h}
if(!this.JSON)this.JSON={stringify:function(a){var c=JSON.stringify;if(typeof a=="boolean"||typeof a=="number"||a===null||typeof a=="undefined")return a+"";else if(typeof a=="string")return'"'+a.replace(/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,function(g){return"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"';else if(a.length){for(var b=0;b<a.length;b++)a[b]=c(a[b]);return"["+a.join(",")+"]"}else{b=[];for(var e in a)b.push(c(e)+
":"+c(a[e]));return"{"+b.join(",")+"}"}},parse:function(a){return eval("("+a+")")}};function startup(){if(onLine()){wave.robot.notifyCapabilitiesHash();getUsername()}if(onLine()==false)document.body.className=document.body.className.replace("online","offline");location.hash.length<2?hashHandler("#search:in:inbox"):hashHandler(location.hash);for(var a=endQueue.length;a--;)endQueue[a]()}
function auto_start(){window.NO_STARTUP||startup();window.offline_cache&&opt.offline&&onLine()&&setTimeout(offline_cache,1337)}auto_start();
